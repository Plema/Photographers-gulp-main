!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(Z){"use strict";var N,c;Z.fn.fileinputLocales={},Z.fn.fileinputThemes={},String.prototype.setTokens=function(e){var t,i,a=this.toString();for(t in e)e.hasOwnProperty(t)&&(i=new RegExp("{"+t+"}","g"),a=a.replace(i,e[t]));return a},N={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",INIT_FLAG:"init-",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],logMessages:{ajaxError:"{status}: {error}. Error Details: {text}.",badDroppedFiles:"Error scanning dropped files!",badExifParser:"Error loading the piexif.js library. {details}",badInputType:'The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.',exifWarning:'To avoid this warning, either set "autoOrientImage" to "false" OR ensure you have loaded the "piexif.js" library correctly on your page before the "fileinput.js" script.',invalidChunkSize:'Invalid upload chunk size: "{chunkSize}". Resumable uploads are disabled.',invalidThumb:'Invalid thumb frame with id: "{id}".',noResumableSupport:"The browser does not support resumable or chunk uploads.",noUploadUrl:'The "uploadUrl" is not set. Ajax uploads and resumable uploads have been disabled.',retryStatus:"Retrying upload for chunk # {chunk} for {filename}... retry # {retry}."},objUrl:window.URL||window.webkitURL,now:function(){return new Date},round:function(e){return e=parseFloat(e),isNaN(e)?0:Math.floor(Math.round(e))},getFileRelativePath:function(e){return String(e.relativePath||e.webkitRelativePath||N.getFileName(e)||null)},getFileId:function(e,t){var i=N.getFileRelativePath(e);return"function"==typeof t?t(e):e&&i?e.size+"_"+i.replace(/\s/gim,"_"):null},getFrameSelector:function(e,t){return'[id="'+e+'"]'+(t=t||"")},getZoomSelector:function(e,t){return'[id="zoom-'+e+'"]'+(t=t||"")},getFrameElement:function(e,t,i){return e.find(N.getFrameSelector(t,i))},getZoomElement:function(e,t,i){return e.find(N.getZoomSelector(t,i))},getElapsed:function(e){var t=e,i="",a={},r={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};return Object.keys(r).forEach(function(e){a[e]=Math.floor(t/r[e]),t-=a[e]*r[e]}),Z.each(a,function(e,t){0<t&&(i+=(i?" ":"")+t+e.substring(0,1))}),i},debounce:function(i,a){var r;return function(){var e=arguments,t=this;clearTimeout(r),r=setTimeout(function(){i.apply(t,e)},a)}},stopEvent:function(e){e.stopPropagation(),e.preventDefault()},getFileName:function(e){return e&&(e.fileName||e.name)||""},createObjectURL:function(e){return N.objUrl&&N.objUrl.createObjectURL&&e?N.objUrl.createObjectURL(e):""},revokeObjectURL:function(e){N.objUrl&&N.objUrl.revokeObjectURL&&e&&N.objUrl.revokeObjectURL(e)},compare:function(e,t,i){return void 0!==e&&(i?e===t:e.match(t))},isIE:function(e){var t;return"Microsoft Internet Explorer"===navigator.appName&&(10===e?new RegExp("msie\\s"+e,"i").test(navigator.userAgent):((t=document.createElement("div")).innerHTML="\x3c!--[if IE "+e+"]> <i></i> <![endif]--\x3e",e=t.getElementsByTagName("i").length,document.body.appendChild(t),t.parentNode.removeChild(t),e))},canAssignFilesToInput:function(){var e=document.createElement("input");try{return e.type="file",!(e.files=null)}catch(e){return!1}},getDragDropFolders:function(e){var t,i,a=e?e.length:0,r=0;if(0<a&&e[0].webkitGetAsEntry())for(t=0;t<a;t++)(i=e[t].webkitGetAsEntry())&&i.isDirectory&&r++;return r},initModal:function(e){var t=Z("body");t.length&&e.appendTo(t)},isEmpty:function(e,t){return null==e||0===e.length||t&&""===Z.trim(e)},isArray:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},ifSet:function(e,t,i){return i=i||"",t&&"object"==typeof t&&e in t?t[e]:i},cleanArray:function(e){return(e=!(e instanceof Array)?[]:e).filter(function(e){return null!=e})},spliceArray:function(e,t,i){var a,r,n=0,o=[];if(!(e instanceof Array))return[];for(r=Z.extend(!0,[],e),i&&r.reverse(),a=0;a<r.length;a++)a!==t&&(o[n]=r[a],n++);return i&&o.reverse(),o},getNum:function(e,t){return t=t||0,"number"==typeof e?e:("string"==typeof e&&(e=parseFloat(e)),isNaN(e)?t:e)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!N.isIE(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},hasFileUploadSupport:function(){return N.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}},hasResumableUploadSupport:function(){return N.hasFileUploadSupport()&&N.hasBlobSupport()&&N.hasArrayBufferViewSupport()&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1)},dataURI2Blob:function(e){var t,i,a,r,n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=N.hasBlobSupport();if(!((o||n)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return null;for(t=(0<=e.split(",")[0].indexOf("base64")?atob:decodeURIComponent)(e.split(",")[1]),i=new ArrayBuffer(t.length),a=new Uint8Array(i),r=0;r<t.length;r+=1)a[r]=t.charCodeAt(r);return e=e.split(",")[0].split(":")[1].split(";")[0],o?new Blob([N.hasArrayBufferViewSupport()?a:i],{type:e}):((n=new n).append(i),n.getBlob(e))},arrayBuffer2String:function(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);for(var t,i,a,r=Array.prototype.slice.apply(new Uint8Array(e)),n="",o=0,l=r.length;o<l;)switch((t=r[o++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(t);break;case 12:case 13:i=r[o++],n+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=r[o++],a=r[o++],n+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&a)<<0)}return n},isHtml:function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.childNodes,a=i.length;a--;)if(1===i[a].nodeType)return!0;return!1},isSvg:function(e){return e.match(/^\s*<\?xml/i)&&(e.match(/<!DOCTYPE svg/i)||e.match(/<svg/i))},getMimeType:function(e,t,i){switch(e){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504E47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(e.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(e.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return t&&!t.match(/[^\u0000-\u007f]/)?"application/text-plain":i}}}},addCss:function(e,t){e.removeClass(t).addClass(t)},getElement:function(e,t,i){return N.isEmpty(e)||N.isEmpty(e[t])?i:Z(e[t])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(100*Math.random())},htmlEncode:function(e,t){return void 0===e?t||null:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(e,t){var i=e;return t&&Z.each(t,function(e,t){"function"==typeof t&&(t=t()),i=i.split(e).join(t)}),i},cleanMemory:function(e){e=(e.is("img")?e:e.find("source")).attr("src");N.revokeObjectURL(e)},findFileName:function(e){var t=e.lastIndexOf("/");return-1===t&&(t=e.lastIndexOf("\\")),e.split(e.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var t=document,i=t.documentElement;i&&e&&!N.checkFullScreen()?i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},moveArray:function(e,t,i,a){var r=Z.extend(!0,[],e);if(a&&r.reverse(),i>=r.length)for(var n=i-r.length;1+n--;)r.push(void 0);return r.splice(i,0,r.splice(t,1)[0]),a&&r.reverse(),r},cleanZoomCache:function(e){var t=e.closest(".kv-zoom-cache-theme");(t=!t.length?e.closest(".kv-zoom-cache"):t).remove()},closeButton:function(e){return'<button type="button" class="'+(e=e?"close "+e:"close")+'" aria-label="Close">\n  <span aria-hidden="true">&times;</span>\n</button>'},getRotation:function(e){switch(e){case 2:return"rotateY(180deg)";case 3:return"rotate(180deg)";case 4:return"rotate(180deg) rotateY(180deg)";case 5:return"rotate(270deg) rotateY(180deg)";case 6:return"rotate(90deg)";case 7:return"rotate(90deg) rotateY(180deg)";case 8:return"rotate(270deg)";default:return""}},setTransform:function(e,t){e&&(e.style.transform=t,e.style.webkitTransform=t,e.style["-moz-transform"]=t,e.style["-ms-transform"]=t,e.style["-o-transform"]=t)}},(c=function(e,t){var i=this;i.$element=Z(e),i.$parent=i.$element.parent(),i._validate()&&(i.isPreviewable=N.hasFileAPISupport(),i.isIE9=N.isIE(9),i.isIE10=N.isIE(10),(i.isPreviewable||i.isIE9)&&(i._init(t),i._listen()),i.$element.removeClass("file-loading"))}).prototype={constructor:c,_cleanup:function(){var e=this;e.reader=null,e.clearFileStack(),e.fileBatchCompleted=!0,e.isError=!1,e.cancelling=!1,e.paused=!1,e.lastProgress=0,e._initAjax()},_initAjax:function(){var e=this;e.ajaxQueue=[],e.ajaxRequests=[],e.ajaxQueueIntervalId=null,e.ajaxCurrentThreads=0,e.ajaxAborted=!1},_init:function(e,t){var i,a,r=this,n=r.$element;r.options=e,Z.each(e,function(e,t){switch(e){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":r[e]=N.getNum(t);break;default:r[e]=t}}),r.rtl&&(a=r.previewZoomButtonIcons.prev,r.previewZoomButtonIcons.prev=r.previewZoomButtonIcons.next,r.previewZoomButtonIcons.next=a),!isNaN(r.maxAjaxThreads)&&r.maxAjaxThreads<r.resumableUploadOptions.maxThreads&&(r.resumableUploadOptions.maxThreads=r.maxAjaxThreads),r._initFileManager(),"function"==typeof r.autoOrientImage&&(r.autoOrientImage=r.autoOrientImage()),"function"==typeof r.autoOrientImageInitial&&(r.autoOrientImageInitial=r.autoOrientImageInitial()),t||r._cleanup(),r.$form=n.closest("form"),r._initTemplateDefaults(),r.uploadFileAttr=N.isEmpty(n.attr("name"))?"file_data":n.attr("name"),i=r._getLayoutTemplate("progress"),r.progressTemplate=i.replace("{class}",r.progressClass),r.progressInfoTemplate=i.replace("{class}",r.progressInfoClass),r.progressPauseTemplate=i.replace("{class}",r.progressPauseClass),r.progressCompleteTemplate=i.replace("{class}",r.progressCompleteClass),r.progressErrorTemplate=i.replace("{class}",r.progressErrorClass),r.isDisabled=n.attr("disabled")||n.attr("readonly"),r.isDisabled&&n.attr("disabled",!0),r.isClickable=r.browseOnZoneClick&&r.showPreview&&(r.dropZoneEnabled||!N.isEmpty(r.defaultPreviewContent)),r.isAjaxUpload=N.hasFileUploadSupport()&&!N.isEmpty(r.uploadUrl),r.dropZoneEnabled=N.hasDragDropSupport()&&r.dropZoneEnabled,r.isAjaxUpload||(r.dropZoneEnabled=r.dropZoneEnabled&&N.canAssignFilesToInput()),r.slug="function"==typeof e.slugCallback?e.slugCallback:r._slugDefault,r.mainTemplate=r.showCaption?r._getLayoutTemplate("main1"):r._getLayoutTemplate("main2"),r.captionTemplate=r._getLayoutTemplate("caption"),r.previewGenericTemplate=r._getPreviewTemplate("generic"),!r.imageCanvas&&r.resizeImage&&(r.maxImageWidth||r.maxImageHeight)&&(r.imageCanvas=document.createElement("canvas"),r.imageCanvasContext=r.imageCanvas.getContext("2d")),N.isEmpty(n.attr("id"))&&n.attr("id",N.uniqId()),r.namespace=".fileinput_"+n.attr("id").replace(/-/g,"_"),void 0===r.$container?r.$container=r._createContainer():r._refreshContainer(),a=r.$container,r.$dropZone=a.find(".file-drop-zone"),r.$progress=a.find(".kv-upload-progress"),r.$btnUpload=a.find(".fileinput-upload"),r.$captionContainer=N.getElement(e,"elCaptionContainer",a.find(".file-caption")),r.$caption=N.getElement(e,"elCaptionText",a.find(".file-caption-name")),N.isEmpty(r.msgPlaceholder)||(i=n.attr("multiple")?r.filePlural:r.fileSingle,r.$caption.attr("placeholder",r.msgPlaceholder.replace("{files}",i))),r.$captionIcon=r.$captionContainer.find(".file-caption-icon"),r.$previewContainer=N.getElement(e,"elPreviewContainer",a.find(".file-preview")),r.$preview=N.getElement(e,"elPreviewImage",a.find(".file-preview-thumbnails")),r.$previewStatus=N.getElement(e,"elPreviewStatus",a.find(".file-preview-status")),r.$errorContainer=N.getElement(e,"elErrorContainer",r.$previewContainer.find(".kv-fileinput-error")),r._validateDisabled(),N.isEmpty(r.msgErrorClass)||N.addCss(r.$errorContainer,r.msgErrorClass),t?r._errorsExist()||r.$errorContainer.hide():(r.$errorContainer.hide(),r.previewInitId="thumb-"+n.attr("id"),r._initPreviewCache(),r._initPreview(!0),r._initPreviewActions(),r.$parent.hasClass("file-loading")&&(r.$container.insertBefore(r.$parent),r.$parent.remove())),r._setFileDropZoneTitle(),n.attr("disabled")&&r.disable(),r._initZoom(),r.hideThumbnailContent&&N.addCss(r.$preview,"hide-content")},_initFileManager:function(){var l=this;l.fileManager={stack:{},processed:[],errors:[],loadedImages:{},totalImages:0,totalFiles:null,totalSize:null,uploadedSize:0,stats:{},initStats:function(e){var t={started:N.now().getTime()};e?l.fileManager.stats[e]=t:l.fileManager.stats=t},getUploadStats:function(e,t,i){var a=l.fileManager,r=(r=e&&a.stats[e]&&a.stats[e].started||null)||N.now().getTime(),n=(N.now().getTime()-r)/1e3,o=n?t/n:0,t={fileId:e,started:r,elapsed:n,loaded:t,total:i,bps:o,bitrate:l._getSize(o,["B/s","KB/s","MB/s","GB/s","TB/s","PB/s","EB/s","ZB/s","YB/s"]),pendingBytes:i-t};return e?a.stats[e]=t:a.stats=t,t},exists:function(e){return-1!==Z.inArray(e,l.fileManager.getIdList())},count:function(){return l.fileManager.getIdList().length},total:function(){var e=l.fileManager;return e.totalFiles||(e.totalFiles=e.count()),e.totalFiles},getTotalSize:function(){var i=l.fileManager;return i.totalSize||(i.totalSize=0,Z.each(l.fileManager.stack,function(e,t){t=parseFloat(t.size);i.totalSize+=isNaN(t)?0:t}),i.totalSize)},add:function(e,t){(t=t||l.fileManager.getId(e))&&(l.fileManager.stack[t]={file:e,name:N.getFileName(e),relativePath:N.getFileRelativePath(e),size:e.size,nameFmt:l._getFileName(e,""),sizeFmt:l._getSize(e.size)})},remove:function(e){e=e.attr("data-fileid");e&&l.fileManager.removeFile(e)},removeFile:function(e){delete l.fileManager.stack[e],delete l.fileManager.loadedImages[e]},move:function(i,a){var r={},n=l.fileManager.stack;(i||a)&&i!==a&&(Z.each(n,function(e,t){e!==i&&(r[e]=t),e===a&&(r[i]=n[i])}),l.fileManager.stack=r)},list:function(){var i=[];return Z.each(l.fileManager.stack,function(e,t){t&&t.file&&i.push(t.file)}),i},isPending:function(e){return-1===Z.inArray(e,l.fileManager.processed)&&l.fileManager.exists(e)},isProcessed:function(){var t=!0,i=l.fileManager;return Z.each(i.stack,function(e){i.isPending(e)&&(t=!1)}),t},clear:function(){var e=l.fileManager;e.totalFiles=null,e.totalSize=null,e.uploadedSize=0,e.stack={},e.errors=[],e.processed=[],e.stats={},e.clearImages()},clearImages:function(){l.fileManager.loadedImages={},l.fileManager.totalImages=0},addImage:function(e,t){l.fileManager.loadedImages[e]=t},removeImage:function(e){delete l.fileManager.loadedImages[e]},getImageIdList:function(){return Object.keys(l.fileManager.loadedImages)},getImageCount:function(){return l.fileManager.getImageIdList().length},getId:function(e){return l._getFileId(e)},getIndex:function(e){return l.fileManager.getIdList().indexOf(e)},getThumb:function(t){var i=null;return l._getThumbs().each(function(){var e=Z(this);e.attr("data-fileid")===t&&(i=e)}),i},getThumbIndex:function(e){e=e.attr("data-fileid");return l.fileManager.getIndex(e)},getIdList:function(){return Object.keys(l.fileManager.stack)},getFile:function(e){return l.fileManager.stack[e]||null},getFileName:function(e,t){e=l.fileManager.getFile(e);return e?t?e.nameFmt||"":e.name||"":""},getFirstFile:function(){var e=l.fileManager.getIdList(),e=e&&e.length?e[0]:null;return l.fileManager.getFile(e)},setFile:function(e,t){l.fileManager.getFile(e)?l.fileManager.stack[e].file=t:l.fileManager.add(t,e)},setProcessed:function(e){l.fileManager.processed.push(e)},getProgress:function(){var e=l.fileManager.total(),t=l.fileManager.processed.length;return e?Math.ceil(t/e*100):0},setProgress:function(e,t){e=l.fileManager.getFile(e);!isNaN(t)&&e&&(e.progress=t)}}},_setUploadData:function(i,e){var a=this;Z.each(e,function(e,t){e=a.uploadParamNames[e]||e;N.isArray(t)?i.append(e,t[0],t[1]):i.append(e,t)})},_initResumableUpload:function(){var f=this,e=f.resumableUploadOptions,g=N.logMessages;if(f.enableResumableUpload){if(!1!==e.fallback&&"function"!=typeof e.fallback&&(e.fallback=function(e){e._log(g.noResumableSupport),e.enableResumableUpload=!1}),N.hasResumableUploadSupport()||!1===e.fallback)return!f.uploadUrl&&f.enableResumableUpload?(f._log(g.noUploadUrl),void(f.enableResumableUpload=!1)):(e.chunkSize=parseFloat(e.chunkSize),e.chunkSize<=0||isNaN(e.chunkSize)?(f._log(g.invalidChunkSize,{chunkSize:e.chunkSize}),void(f.enableResumableUpload=!1)):(f.resumableManager={init:function(e,t,i){var a=f.resumableManager,r=f.fileManager;a.currThreads=0,a.logs=[],a.stack=[],a.error="",a.chunkIntervalId=null,a.id=e,a.file=t.file,a.fileName=t.name,a.fileIndex=i,a.completed=!1,a.testing=!1,a.lastProgress=0,f.showPreview&&(a.$thumb=r.getThumb(e)||null,a.$progress=a.$btnDelete=null,a.$thumb&&a.$thumb.length&&(a.$progress=a.$thumb.find(".file-thumb-progress"),a.$btnDelete=a.$thumb.find(".kv-file-remove"))),a.chunkSize=1024*f.resumableUploadOptions.chunkSize,a.chunkCount=a.getTotalChunks()},logAjaxError:function(e,t,i){f.resumableUploadOptions.showErrorLog&&f._log(g.ajaxError,{status:e.status,error:i,text:e.responseText||""})},reset:function(){f.resumableManager.processed={}},setProcessed:function(e){var t=f.resumableManager,i=f.fileManager,a=t.id,r=t.$thumb,n=t.$progress,o=r&&r.length,l={id:o?r.attr("id"):"",index:i.getIndex(a),fileId:a};t.completed=!0,t.lastProgress=0,i.uploadedSize+=t.file.size,o&&r.removeClass("file-uploading"),"success"===e?(f.showPreview&&(f._setProgress(101,n),f._setThumbStatus(r,"Success"),f._initUploadSuccess(t.processed[a].data,r)),f.fileManager.removeFile(a),delete t.processed[a],f._raise("fileuploaded",[l.id,l.index,l.fileId]),i.isProcessed()&&f._setProgress(101)):(f.showPreview&&(f._setThumbStatus(r,"Error"),f._setPreviewError(r,!0),f._setProgress(101,n,f.msgProgressError),f._setProgress(101,f.$progress,f.msgProgressError),f.cancelling=!0),f.$errorContainer.find('li[data-file-id="'+l.fileId+'"]').length||(n=f.msgResumableUploadRetriesExceeded.setTokens({file:t.fileName,max:f.resumableUploadOptions.maxRetries,error:t.error}),f._showFileError(n,l))),i.isProcessed()&&t.reset()},check:function(){var e=f.resumableManager,i=!0;Z.each(e.logs,function(e,t){if(!t)return i=!1}),i&&(clearInterval(e.chunkIntervalId),e.setProcessed("success"))},processedResumables:function(){var e,t=f.resumableManager.logs,i=0;if(!t||!t.length)return 0;for(e=0;e<t.length;e++)!0===t[e]&&i++;return i},getUploadedSize:function(){var e=f.resumableManager,t=e.processedResumables()*e.chunkSize;return t>e.file.size?e.file.size:t},getTotalChunks:function(){var e=f.resumableManager,t=parseFloat(e.chunkSize);return!isNaN(t)&&0<t?Math.ceil(e.file.size/t):0},getProgress:function(){var e=f.resumableManager,t=e.processedResumables(),e=e.chunkCount;return 0===e?0:Math.ceil(t/e*100)},checkAborted:function(e){(f.paused||f.cancelling)&&(clearInterval(e),f.unlock())},upload:function(){var t=f.resumableManager,i=f.fileManager,a=i.getIdList(),r="new",n=setInterval(function(){var e;t.checkAborted(n),"new"===r&&(f.lock(),r="processing",e=a.shift(),i.initStats(e),i.stack[e]&&(t.init(e,i.stack[e],i.getIndex(e)),t.testUpload(),t.uploadResumable())),!i.isPending(e)&&t.completed&&(r="new"),i.isProcessed()&&((e=f.$preview.find(".file-preview-initial")).length&&(N.addCss(e,N.SORT_CSS),f._initSortable()),clearInterval(n),f._clearFileInput(),f.unlock(),setTimeout(function(){var e=f.previewCache.data;e&&(f.initialPreview=e.content,f.initialPreviewConfig=e.config,f.initialPreviewThumbTags=e.tags),f._raise("filebatchuploadcomplete",[f.initialPreview,f.initialPreviewConfig,f.initialPreviewThumbTags,f._getExtraData()])},f.processDelay))},f.processDelay)},uploadResumable:function(){for(var e=f.resumableManager,t=e.chunkCount,i=0;i<t;i++)e.logs[i]=!(!e.processed[e.id]||!e.processed[e.id][i]);for(i=0;i<t;i++)e.pushAjax(i,0);e.chunkIntervalId=setInterval(e.loopAjax,f.queueDelay)},testUpload:function(){var r,e,t,i,a,n,o=f.resumableManager,l=f.resumableUploadOptions,s=f.fileManager,d=o.id;l.testUrl?(o.testing=!0,r=new FormData,a=s.stack[d],f._setUploadData(r,{fileId:d,fileName:a.fileName,fileSize:a.size,fileRelativePath:a.relativePath,chunkSize:o.chunkSize,chunkCount:o.chunkCount}),e=function(e){n=f._getOutData(r,e),f._raise("filetestbeforesend",[d,s,o,n])},t=function(e,t,i){n=f._getOutData(r,i,e);var a=f.uploadParamNames.chunksUploaded||"chunksUploaded",i=[d,s,o,n];e[a]&&N.isArray(e[a])?(o.processed[d]||(o.processed[d]={}),Z.each(e[a],function(e,t){o.logs[t]=!0,o.processed[d][t]=!0}),o.processed[d].data=e,f._raise("filetestsuccess",i)):f._raise("filetesterror",i),o.testing=!1},i=function(e,t,i){n=f._getOutData(r,e),f._raise("filetestajaxerror",[d,s,o,n]),o.logAjaxError(e,t,i),o.testing=!1},a=function(){f._raise("filetestcomplete",[d,s,o,f._getOutData(r)]),o.testing=!1},f._ajaxSubmit(e,t,a,i,r,d,o.fileIndex,l.testUrl)):o.testing=!1},pushAjax:function(e,t){f.resumableManager.stack.push([e,t])},sendAjax:function(n,o){var l,e,s,d=f.fileManager,c=f.resumableManager,t=f.resumableUploadOptions,i=c.chunkSize,u=c.id,a=c.file,r=c.$thumb,p=c.$btnDelete;c.processed[u]&&c.processed[u][n]||(c.currThreads++,o>t.maxRetries?c.setProcessed("error"):(e=a[a.slice?"slice":a.mozSlice?"mozSlice":a.webkitSlice?"webkitSlice":"slice"](i*n,i*(n+1)),s=new FormData,t=d.stack[u],f._setUploadData(s,{chunkCount:c.chunkCount,chunkIndex:n,chunkSize:i,chunkSizeStart:i*n,fileBlob:[e,c.fileName],fileId:u,fileName:c.fileName,fileRelativePath:t.relativePath,fileSize:a.size,retryCount:o}),c.$progress&&c.$progress.length&&c.$progress.show(),i=function(e){l=f._getOutData(s,e),f.showPreview&&(r.hasClass("file-preview-success")||(f._setThumbStatus(r,"Loading"),N.addCss(r,"file-uploading")),p.attr("disabled",!0)),f._raise("filechunkbeforesend",[u,n,o,d,c,l])},e=function(e,t,i){l=f._getOutData(s,i,e);var a=f.uploadParamNames.chunkIndex||"chunkIndex",r=f.resumableUploadOptions,i=[u,n,o,d,c,l];c.currThreads--,e.error?(r.showErrorLog&&f._log(g.retryStatus,{retry:o+1,filename:c.fileName,chunk:n}),c.pushAjax(n,o+1),c.error=e.error,f._raise("filechunkerror",i)):(c.logs[e[a]]=!0,c.processed[u]||(c.processed[u]={}),c.processed[u][e[a]]=!0,c.processed[u].data=e,f._raise("filechunksuccess",i),c.check())},t=function(e,t,i){l=f._getOutData(s,e),c.currThreads--,c.error=i,c.logAjaxError(e,t,i),f._raise("filechunkajaxerror",[u,n,o,d,c,l]),c.pushAjax(n,o+1)},a=function(){f._raise("filechunkcomplete",[u,n,o,d,c,f._getOutData(s)])},f._ajaxSubmit(i,e,a,t,s,u,c.fileIndex)))},loopAjax:function(){var e,t,i=f.resumableManager;i.currThreads<f.resumableUploadOptions.maxThreads&&!i.testing&&(void 0!==(e=i.stack.shift())&&(t=e[0],i.processed[i.id]&&i.processed[i.id][t]?i.processedResumables()>=i.getTotalChunks()&&(i.setProcessed("success"),clearInterval(i.chunkIntervalId)):i.sendAjax(t,e[1])))}},void f.resumableManager.reset()));e.fallback(f)}},_initTemplateDefaults:function(){var i=this,e=N.closeButton("fileinput-remove"),t='<div id="'+N.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+N.MODAL_ID+'Label"></div>',a=" {style}",r='<video class="kv-preview-data file-preview-video" controls'+a+'>\n<source src="{data}" type="{type}">\n'+N.DEFAULT_PREVIEW+"\n</video>\n",n='\x3c!--suppress ALL --\x3e<audio class="kv-preview-data file-preview-audio" controls'+a+'>\n<source src="{data}" type="{type}">\n'+N.DEFAULT_PREVIEW+"\n</audio>\n",o='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf"'+a+">\n",l='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}"'+a+'>\n<param name="movie" value="{caption}" />\n'+N.OBJECT_PARAMS+" "+N.DEFAULT_PREVIEW+"\n</object>\n",s='<div class="kv-preview-data file-preview-other-frame"'+a+">\n"+N.DEFAULT_PREVIEW+"\n</div>\n",a={width:"100%",height:"100%","min-height":"480px"};i._isPdfRendered()&&(o=i.pdfRendererTemplate.replace("{renderer}",i._encodeURI(i.pdfRendererUrl))),i.defaults={layoutTemplates:{main1:'{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="input-group {class}">\n  {caption}\n<div class="input-group-btn input-group-append">\n      {remove}\n      {cancel}\n      {pause}\n      {upload}\n      {browse}\n    </div>\n</div>',main2:'{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',close:e,fileIcon:'<i class="glyphicon glyphicon-file"></i>',caption:'<div class="file-caption form-control {class}" tabindex="500">\n  <span class="file-caption-icon"></span>\n  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n</div>',modalMain:t,modal:'<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}</h5>\n      <span class="kv-zoom-title"></span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>{stats}',stats:'<div class="text-info file-upload-stats"><span class="pending-time">{pendingTime}</span> <span class="upload-speed">{uploadSpeed}</span></div>',size:" <samp>({sizeText})</samp>",footer:'<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',indicator:'<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',actionDownload:'<a class="kv-file-download {downloadClass}" title="{downloadTitle}" href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}</a>',actionZoom:'<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',actionDrag:'<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',btnDefault:'<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',btnLink:'<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',btnBrowse:'<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',zoomCache:'<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>'},previewMarkupTags:{tagBefore1:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-fileid="{fileid}" data-template="{template}"><div class="kv-file-content">\n',tagBefore2:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-fileid="{fileid}" data-template="{template}" title="{caption}"><div class="kv-file-content">\n',tagAfter:"</div>{footer}\n</div>\n"},previewContentTemplates:{generic:"{content}\n",html:'<div class="kv-preview-data file-preview-html" title="{caption}" {style}>{data}</div>\n',image:'<img src="{data}" class="file-preview-image kv-preview-data" title="{title}" alt="{alt}" {style}>\n',text:'<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly {style}>{data}</textarea>\n',office:'<iframe class="kv-preview-data file-preview-office" src="https://view.officeapps.live.com/op/embed.aspx?src={data}" {style}></iframe>',gdocs:'<iframe class="kv-preview-data file-preview-gdocs" src="https://docs.google.com/gview?url={data}&embedded=true" {style}></iframe>',video:r,audio:n,flash:'<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash" {style}>\n',object:l,pdf:o,other:s},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},gdocs:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"100%",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},gdocs:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:a,text:a,office:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},gdocs:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:a,other:{width:"auto",height:"100%","min-height":"480px"}},mimeTypeAliases:{"video/quicktime":"video/mp4"},fileTypeSettings:{image:function(e,t){return N.compare(e,"image.*")&&!N.compare(e,/(tiff?|wmf)$/i)||N.compare(t,/\.(gif|png|jpe?g)$/i)},html:function(e,t){return N.compare(e,"text/html")||N.compare(t,/\.(htm|html)$/i)},office:function(e,t){return N.compare(e,/(word|excel|powerpoint|office)$/i)||N.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?)$/i)},gdocs:function(e,t){return N.compare(e,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||N.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?|rtf|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(e,t){return N.compare(e,"text.*")||N.compare(t,/\.(xml|javascript)$/i)||N.compare(t,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(e,t){return N.compare(e,"video.*")&&(N.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||N.compare(t,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,t){return N.compare(e,"audio.*")&&(N.compare(t,/(ogg|mp3|mp?g|wav)$/i)||N.compare(t,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,t){return N.compare(e,"application/x-shockwave-flash",!0)||N.compare(t,/\.(swf)$/i)},pdf:function(e,t){return N.compare(e,"application/pdf",!0)||N.compare(t,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorPaused:'<i class="glyphicon glyphicon-pause text-primary"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ...",indicatorPausedTitle:"Upload Paused"}},Z.each(i.defaults,function(e,t){"allowedPreviewTypes"!==e?i[e]=Z.extend(!0,{},t,i[e]):void 0===i.allowedPreviewTypes&&(i.allowedPreviewTypes=t)}),i._initPreviewTemplates()},_initPreviewTemplates:function(){var i,a=this,r=a.previewMarkupTags,n=r.tagAfter;Z.each(a.previewContentTemplates,function(e,t){N.isEmpty(a.previewTemplates[e])&&(i=r.tagBefore2,"generic"!==e&&"image"!==e&&"html"!==e&&"text"!==e||(i=r.tagBefore1),a._isPdfRendered()&&"pdf"===e&&(i=i.replace("kv-file-content","kv-file-content kv-pdf-rendered")),a.previewTemplates[e]=i+t+n)})},_initPreviewCache:function(){var f=this;f.previewCache={data:{},init:function(){var e=f.initialPreview;0<e.length&&!N.isArray(e)&&(e=e.split(f.initialPreviewDelimiter)),f.previewCache.data={content:e,config:f.initialPreviewConfig,tags:f.initialPreviewThumbTags}},count:function(e){return f.previewCache.data&&f.previewCache.data.content?(e?f.previewCache.data.content.filter(function(e){return null!==e}):f.previewCache.data.content).length:0},get:function(e,t){function i(e,t,i,a,r,n,o,l){var s=" file-preview-initial "+N.SORT_CSS+(o?" "+o:""),d=f.previewInitId+"-"+N.INIT_FLAG+n,o=c&&c.fileId||d;return f._generatePreviewTemplate(e,t,i,a,d,o,!1,null,s,r,n,l,p,c&&c.zoomData||t)}var a,r,n,o,l=N.INIT_FLAG+e,s=f.previewCache.data,c=s.config[e],d=s.content[e],u=N.ifSet("previewAsData",c,f.initialPreviewAsData),p=c?{title:c.title||null,alt:c.alt||null}:{title:null,alt:null};return d&&d.length?(t=void 0===t||t,a=N.ifSet("type",c,f.initialPreviewFileType||"generic"),n=N.ifSet("filename",c,N.ifSet("caption",c)),o=N.ifSet("filetype",c,a),r=f.previewCache.footer(e,t,c&&c.size||null),t=N.ifSet("frameClass",c),a=u?i(a,d,n,o,r,l,t):i("generic",d,n,o,r,l,t,a).setTokens({content:s.content[e]}),s.tags.length&&s.tags[e]&&(a=N.replaceTags(a,s.tags[e])),N.isEmpty(c)||N.isEmpty(c.frameAttr)||((e=Z(document.createElement("div")).html(a)).find(".file-preview-initial").attr(c.frameAttr),a=e.html(),e.remove()),a):""},clean:function(e){e.content=N.cleanArray(e.content),e.config=N.cleanArray(e.config),e.tags=N.cleanArray(e.tags),f.previewCache.data=e},add:function(e,t,i,a){var r=f.previewCache.data,n=e.length-1;return e&&e.length&&(N.isArray(e)||(e=e.split(f.initialPreviewDelimiter)),a?(n=r.content.push(e[0])-1,r.config[n]=t,r.tags[n]=i):(r.content=e,r.config=t,r.tags=i),f.previewCache.clean(r)),n},set:function(e,t,i,a){var r,n=f.previewCache.data;if(e&&e.length&&(e=!N.isArray(e)?e.split(f.initialPreviewDelimiter):e).filter(function(e){return null!==e}).length){if(void 0===n.content&&(n.content=[]),void 0===n.config&&(n.config=[]),void 0===n.tags&&(n.tags=[]),a){for(r=0;r<e.length;r++)e[r]&&n.content.push(e[r]);for(r=0;r<t.length;r++)t[r]&&n.config.push(t[r]);for(r=0;r<i.length;r++)i[r]&&n.tags.push(i[r])}else n.content=e,n.config=t,n.tags=i;f.previewCache.clean(n)}},unset:function(e){var t=f.previewCache.count(),i=f.reversePreviewOrder;if(t){if(1===t)return f.previewCache.data.content=[],f.previewCache.data.config=[],f.previewCache.data.tags=[],f.initialPreview=[],f.initialPreviewConfig=[],void(f.initialPreviewThumbTags=[]);f.previewCache.data.content=N.spliceArray(f.previewCache.data.content,e,i),f.previewCache.data.config=N.spliceArray(f.previewCache.data.config,e,i),f.previewCache.data.tags=N.spliceArray(f.previewCache.data.tags,e,i);i=Z.extend(!0,{},f.previewCache.data);f.previewCache.clean(i)}},out:function(){var e,t,i="",a=f.previewCache.count();if(0===a)return{content:"",caption:""};for(e=0;e<a;e++)t=f.previewCache.get(e),i=f.reversePreviewOrder?t+i:i+t;return{content:i,caption:f._getMsgSelected(a)}},footer:function(e,t,i){var a=f.previewCache.data||{};if(N.isEmpty(a.content))return"";(N.isEmpty(a.config)||N.isEmpty(a.config[e]))&&(a.config[e]={}),t=void 0===t||t;var r=a.config[e],n=N.ifSet("caption",r),o=N.ifSet("width",r,"auto"),l=N.ifSet("url",r,!1),s=N.ifSet("key",r,null),d=N.ifSet("fileId",r,null),c=f.fileActionSettings,u=f.initialPreviewShowDelete||!1,p=f.initialPreviewDownloadUrl?f.initialPreviewDownloadUrl+"?key="+s+(d?"&fileId="+d:""):"",a=r.downloadUrl||p,e=r.filename||r.caption||"",d=!!a,p=N.ifSet("showRemove",r,N.ifSet("showRemove",c,u)),u=N.ifSet("showDownload",r,N.ifSet("showDownload",c,d)),d=N.ifSet("showZoom",r,N.ifSet("showZoom",c,!0)),c=N.ifSet("showDrag",r,N.ifSet("showDrag",c,!0)),t=!1===l&&t,u=u&&!1!==r.downloadUrl&&!!a,e=f._renderFileActions(r,!1,u,p,d,c,t,l,s,!0,a,e);return f._getLayoutTemplate("footer").setTokens({progress:f._renderThumbProgress(),actions:e,caption:n,size:f._getSize(i),width:o,indicator:""})}},f.previewCache.init()},_isPdfRendered:function(){var e=this.usePdfRenderer;return("function"==typeof e?e():!!e)&&this.pdfRendererUrl},_handler:function(e,t,i){var a=this.namespace,a=t.split(" ").join(a+" ")+a;e&&e.length&&e.off(a).on(a,i)},_encodeURI:function(e){return this.encodeUrl?encodeURI(e):e},_log:function(e,t){var i=this.$element.attr("id");e="bootstrap-fileinput: "+(e=i?'"'+i+'": '+e:e),"object"==typeof t&&e.setTokens(t),void 0!==window.console.log?window.console.log(e):window.alert(e)},_validate:function(){var e="file"===this.$element.attr("type");return e||this._log(N.logMessages.badInputType),e},_errorsExist:function(){var e;return!!this.$errorContainer.find("li").length||((e=Z(document.createElement("div")).html(this.$errorContainer.html())).find(".kv-error-close").remove(),e.find("ul").remove(),!!Z.trim(e.text()).length)},_errorHandler:function(e,t){var i=this,a=e.target.error,e=function(e){i._showError(e.replace("{name}",t))};a.code===a.NOT_FOUND_ERR?e(i.msgFileNotFound):a.code===a.SECURITY_ERR?e(i.msgFileSecured):a.code===a.NOT_READABLE_ERR?e(i.msgFileNotReadable):a.code===a.ABORT_ERR?e(i.msgFilePreviewAborted):e(i.msgFilePreviewError)},_addError:function(e){var t=this,i=t.$errorContainer;e&&i.length&&(i.html(t.errorCloseButton+e),t._handler(i.find(".kv-error-close"),"click",function(){setTimeout(function(){t.showPreview&&!t.getFrames().length&&t.clear(),i.fadeOut("slow")},t.processDelay)}))},_setValidationError:function(e){e=(e?e+" ":"")+"has-error",this.$container.removeClass(e).addClass("has-error"),N.addCss(this.$captionContainer,"is-invalid")},_resetErrors:function(e){var t=this.$errorContainer;this.isError=!1,this.$container.removeClass("has-error"),this.$captionContainer.removeClass("is-invalid"),t.html(""),e?t.fadeOut("slow"):t.hide()},_showFolderError:function(e){var t,i=this,a=i.$errorContainer;e&&(i.isAjaxUpload||i._clearFileInput(),t=i.msgFoldersNotAllowed.replace("{n}",e),i._addError(t),i._setValidationError(),a.fadeIn(800),i._raise("filefoldererror",[e,t]))},_showFileError:function(e,t,i){var a=this.$errorContainer,r=i||"fileuploaderror",i=t&&t.fileId||"",i=t&&t.id?'<li data-thumb-id="'+t.id+'" data-file-id="'+i+'">'+e+"</li>":"<li>"+e+"</li>";return 0===a.find("ul").length?this._addError("<ul>"+i+"</ul>"):a.find("ul").append(i),a.fadeIn(800),this._raise(r,[t,e]),this._setValidationError("file-input-new"),!0},_showError:function(e,t,i){var a=this,r=a.$errorContainer,i=i||"fileerror";return(t=t||{}).reader=a.reader,a._addError(e),r.fadeIn(800),a._raise(i,[t,e]),a.isAjaxUpload||a._clearFileInput(),a._setValidationError("file-input-new"),a.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(e){var t=this,i=1<t.minFileCount?t.filePlural:t.fileSingle,a=t.msgFilesTooLess.replace("{n}",t.minFileCount).replace("{files}",i),i=t.$errorContainer;t._addError(a),t.isError=!0,t._updateFileDetails(0),i.fadeIn(800),t._raise("fileerror",[e,a]),t._clearFileInput(),t._setValidationError()},_parseError:function(e,t,i,a){var r=this,n=Z.trim(i+""),i=void 0!==t.responseJSON&&void 0!==t.responseJSON.error?t.responseJSON.error:t.responseText;return r.cancelling&&r.msgUploadAborted&&(n=r.msgUploadAborted),r.showAjaxErrorDetails&&i&&(t=(i=Z.trim(i.replace(/\n\s*\n/g,"\n"))).length?"<pre>"+i+"</pre>":"",n+=n?t:i),n=n||r.msgAjaxError.replace("{operation}",e),r.cancelling=!1,a?"<b>"+a+": </b>"+n:n},_parseFileType:function(e,t){var i,a,r=this.allowedPreviewTypes||[];if("application/text-plain"===e)return"text";for(a=0;a<r.length;a++)if(i=r[a],i=(0,this.fileTypeSettings[i])(e,t)?i:"",!N.isEmpty(i))return i;return"other"},_getPreviewIcon:function(e){var i,a=this,r=null;return e&&-1<e.indexOf(".")&&(i=e.split(".").pop(),a.previewFileIconSettings&&(r=a.previewFileIconSettings[i]||a.previewFileIconSettings[i.toLowerCase()]||null),a.previewFileExtSettings&&Z.each(a.previewFileExtSettings,function(e,t){a.previewFileIconSettings[e]&&t(i)&&(r=a.previewFileIconSettings[e])})),r||a.previewFileIcon},_parseFilePreviewIcon:function(e,t){t=this._getPreviewIcon(t);return e=-1<e.indexOf("{previewFileIcon}")?e.setTokens({previewFileIconClass:this.previewFileIconClass,previewFileIcon:t}):e},_raise:function(e,t){var i=Z.Event(e);if(void 0!==t?this.$element.trigger(i,t):this.$element.trigger(i),i.isDefaultPrevented()||!1===i.result)return!1;switch(e){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:this.ajaxAborted||(this.ajaxAborted=i.result)}return!0},_listenFullScreen:function(e){var t,i,a=this.$modal;a&&a.length&&(t=a&&a.find(".btn-fullscreen"),i=a&&a.find(".btn-borderless"),t.length&&i.length&&(t.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),(e?t:i).addClass("active").attr("aria-pressed","true"),a.hasClass("file-zoom-fullscreen")||e?this._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var e=this,t=e.$element,i=e.$form,a=e.$container;e._handler(t,"click",function(e){t.hasClass("file-no-browse")&&(t.data("zoneClicked")?t.data("zoneClicked",!1):e.preventDefault())}),e._handler(t,"change",Z.proxy(e._change,e)),e.showBrowse&&e._handler(e.$btnFile,"click",Z.proxy(e._browse,e)),e._handler(a.find(".fileinput-remove:not([disabled])"),"click",Z.proxy(e.clear,e)),e._handler(a.find(".fileinput-cancel"),"click",Z.proxy(e.cancel,e)),e._handler(a.find(".fileinput-pause"),"click",Z.proxy(e.pause,e)),e._initDragDrop(),e._handler(i,"reset",Z.proxy(e.clear,e)),e.isAjaxUpload||e._handler(i,"submit",Z.proxy(e._submitForm,e)),e._handler(e.$container.find(".fileinput-upload"),"click",Z.proxy(e._uploadClick,e)),e._handler(Z(window),"resize",function(){e._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),e._handler(Z(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){e._listenFullScreen(N.checkFullScreen())}),e._autoFitContent(),e._initClickable(),e._refreshPreview()},_autoFitContent:function(){var i,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=this,e=e<400?a.previewSettingsSmall||a.defaults.previewSettingsSmall:a.previewSettings||a.defaults.previewSettings;Z.each(e,function(e,t){i=".file-preview-frame .file-preview-"+e,a.$preview.find(i+".kv-preview-data,"+i+" .kv-preview-data").css(t)})},_scanDroppedItems:function(t,i,a){a=a||"";function e(e){l._log(N.logMessages.badDroppedFiles),l._log(e)}var r,n,o,l=this;t.isFile?t.file(function(e){i.push(e)},e):t.isDirectory&&(n=t.createReader(),(o=function(){n.readEntries(function(e){if(e&&0<e.length){for(r=0;r<e.length;r++)l._scanDroppedItems(e[r],i,a+t.name+"/");o()}return null},e)})())},_initDragDrop:function(){var e=this,t=e.$dropZone;e.dropZoneEnabled&&e.showPreview&&(e._handler(t,"dragenter dragover",Z.proxy(e._zoneDragEnter,e)),e._handler(t,"dragleave",Z.proxy(e._zoneDragLeave,e)),e._handler(t,"drop",Z.proxy(e._zoneDrop,e)),e._handler(Z(document),"dragenter dragover drop",e._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var t=e.originalEvent.dataTransfer,i=-1<Z.inArray("Files",t.types);if(this._zoneDragDropInit(e),this.isDisabled||!i)return e.originalEvent.dataTransfer.effectAllowed="none",void(e.originalEvent.dataTransfer.dropEffect="none");this._raise("fileDragEnter",{sourceEvent:e,files:t.types.Files})&&N.addCss(this.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){this._zoneDragDropInit(e),this.isDisabled||this._raise("fileDragLeave",{sourceEvent:e})&&this.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){function t(){a.isAjaxUpload?a._change(e,o):(a.changeTriggered=!0,r.get(0).files=o,setTimeout(function(){a.changeTriggered=!1,r.trigger("change"+a.namespace)},a.processDelay)),a.$dropZone.removeClass("file-highlighted")}var i,a=this,r=a.$element,n=e.originalEvent.dataTransfer,o=n.files,l=n.items,n=N.getDragDropFolders(l);if(e.preventDefault(),!a.isDisabled&&!N.isEmpty(o)&&a._raise("fileDragDrop",{sourceEvent:e,files:o}))if(0<n)if(a.isAjaxUpload){for(o=[],i=0;i<l.length;i++){var s=l[i].webkitGetAsEntry();s&&a._scanDroppedItems(s,o)}setTimeout(function(){t()},500)}else a._showFolderError(n);else t()},_uploadClick:function(e){var t=this.$container.find(".fileinput-upload"),i=!t.hasClass("disabled")&&N.isEmpty(t.attr("disabled"));e&&e.isDefaultPrevented()||(this.isAjaxUpload?(e.preventDefault(),i&&this.upload()):i&&"submit"!==t.attr("type")&&((t=t.closest("form")).length&&t.trigger("submit"),e.preventDefault()))},_submitForm:function(){return this._isFileSelectionValid()&&!this._abort({})},_clearPreview:function(){var i=this;(i.showUploadedThumbs?i.getFrames(":not(.file-preview-success)"):i.getFrames()).each(function(){var e=Z(this),t=e.attr("id"),t=i._getZoom(t);e.remove(),N.cleanZoomCache(t)}),i.getFrames().length&&i.showPreview||i._resetUpload(),i._validateDefaultPreview()},_initSortable:function(){var r=this,e=r.$preview,t="."+N.SORT_CSS,n=r.reversePreviewOrder;window.KvSortable&&0!==e.find(t).length&&(t={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:t,onSort:function(e){var t=e.oldIndex,i=e.newIndex,a=0;r.initialPreview=N.moveArray(r.initialPreview,t,i,n),r.initialPreviewConfig=N.moveArray(r.initialPreviewConfig,t,i,n),r.previewCache.init(),r.getFrames(".file-preview-initial").each(function(){Z(this).attr("data-fileindex",N.INIT_FLAG+a),a++}),r._raise("filesorted",{previewId:Z(e.item).attr("id"),oldIndex:t,newIndex:i,stack:r.initialPreviewConfig})}},e.data("kvsortable")&&e.kvsortable("destroy"),Z.extend(!0,t,r.fileActionSettings.dragSettings),e.kvsortable(t))},_setPreviewContent:function(e){this.$preview.html(e),this._autoFitContent()},_initPreviewImageOrientations:function(){var r=this,n=0;r.autoOrientImageInitial&&r.getFrames(".file-preview-initial").each(function(){var e,t,i=Z(this),a=r.initialPreviewConfig[n];a&&a.exif&&a.exif.Orientation&&(t=i.attr("id"),e=i.find(">.kv-file-content img"),t=r._getZoom(t," >.kv-file-content img"),r.setImageOrientation(e,t,a.exif.Orientation,i)),n++})},_initPreview:function(e){var t,i=this,a=i.initialCaption||"";if(!i.previewCache.count(!0))return i._clearPreview(),void(e?i._setCaption(a):i._initCaption());t=i.previewCache.out(),a=e&&i.initialCaption?i.initialCaption:t.caption,i._setPreviewContent(t.content),i._setInitThumbAttr(),i._setCaption(a),i._initSortable(),N.isEmpty(t.content)||i.$container.removeClass("file-input-new"),i._initPreviewImageOrientations()},_getZoomButton:function(e){var t=this.previewZoomButtonIcons[e],i=this.previewZoomButtonClasses[e],a=' title="'+(this.previewZoomButtonTitles[e]||"")+'" '+("close"===e?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==e&&"borderless"!==e&&"toggleheader"!==e||(a+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+i+" btn-"+e+'"'+a+">"+t+"</button>"},_getModalContent:function(){var e=this;return e._getLayoutTemplate("modal").setTokens({rtl:e.rtl?" kv-rtl":"",zoomFrameClass:e.frameClass,heading:e.msgZoomModalHeading,prev:e._getZoomButton("prev"),next:e._getZoomButton("next"),toggleheader:e._getZoomButton("toggleheader"),fullscreen:e._getZoomButton("fullscreen"),borderless:e._getZoomButton("borderless"),close:e._getZoomButton("close")})},_listenModalEvent:function(a){var r=this,n=r.$modal;n.on(a+".bs.modal",function(e){var t=n.find(".btn-fullscreen"),i=n.find(".btn-borderless");r._raise("filezoom"+a,{sourceEvent:e,previewId:n.data("previewId"),modal:n}),"shown"===a&&(i.removeClass("active").attr("aria-pressed","false"),t.removeClass("active").attr("aria-pressed","false"),n.hasClass("file-zoom-fullscreen")&&(r._maximizeZoomDialog(),(N.checkFullScreen()?t:i).addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var i=this,e=i._getLayoutTemplate("modalMain"),t="#"+N.MODAL_ID;i.showPreview&&(i.$modal=Z(t),i.$modal&&i.$modal.length||(e=Z(document.createElement("div")).html(e).insertAfter(i.$container),i.$modal=Z(t).insertBefore(e),e.remove()),N.initModal(i.$modal),i.$modal.html(i._getModalContent()),Z.each(N.MODAL_EVENTS,function(e,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var e,t=this.$modal.data("previewId")||"",i=this.getFrames().toArray(),a=i.length,r=this.$modal.find(".btn-prev"),n=this.$modal.find(".btn-next");if(i.length<2)return r.hide(),void n.hide();r.show(),n.show(),a&&(e=Z(i[0]),a=Z(i[a-1]),r.removeAttr("disabled"),n.removeAttr("disabled"),e.length&&e.attr("id")===t&&r.attr("disabled",!0),a.length&&a.attr("id")===t&&n.attr("disabled",!0))},_maximizeZoomDialog:function(){var e=this.$modal,t=e.find(".modal-header:visible"),i=e.find(".modal-footer:visible"),a=e.find(".modal-body"),r=Z(window).height();e.addClass("file-zoom-fullscreen"),t&&t.length&&(r-=t.outerHeight(!0)),i&&i.length&&(r-=i.outerHeight(!0)),a&&a.length&&(r-=a.outerHeight(!0)-a.height()),e.find(".kv-zoom-body").height(r)},_resizeZoomDialog:function(e){var t=this,i=t.$modal,a=i.find(".btn-fullscreen"),r=i.find(".btn-borderless");if(i.hasClass("file-zoom-fullscreen"))N.toggleFullScreen(!1),e?a.hasClass("active")||(i.removeClass("file-zoom-fullscreen"),t._resizeZoomDialog(!0),r.hasClass("active")&&r.removeClass("active").attr("aria-pressed","false")):a.hasClass("active")?a.removeClass("active").attr("aria-pressed","false"):(i.removeClass("file-zoom-fullscreen"),t.$modal.find(".kv-zoom-body").css("height",t.zoomModalHeight));else{if(!e)return void t._maximizeZoomDialog();N.toggleFullScreen(!0)}i.focus()},_setZoomContent:function(e,t){var i,a,r,o=this,n=e.attr("id"),l=o._getZoom(n),s=o.$modal,d=s.find(".btn-fullscreen"),c=s.find(".btn-borderless"),u=s.find(".btn-toggleheader"),p=l.attr("data-template")||"generic",l=l.find(".kv-file-content"),l=l.length?l.html():"",e=(e.data("caption")||"")+" "+(e.data("size")||"");s.find(".kv-zoom-title").attr("title",Z("<div/>").html(e).text()).html(e),i=s.find(".kv-zoom-body"),s.removeClass("kv-single-content"),t?(r=i.addClass("file-thumb-loading").clone().insertAfter(i),i.html(l).hide(),r.fadeOut("fast",function(){i.fadeIn("fast",function(){i.removeClass("file-thumb-loading")}),r.remove()})):i.html(l),(p=o.previewZoomSettings[p])&&(a=i.find(".kv-preview-data"),N.addCss(a,"file-zoom-detail"),Z.each(p,function(e,t){a.css(e,t),(a.attr("width")&&"width"===e||a.attr("height")&&"height"===e)&&a.removeAttr(e)})),s.data("previewId",n),o._handler(s.find(".btn-prev"),"click",function(){o._zoomSlideShow("prev",n)}),o._handler(s.find(".btn-next"),"click",function(){o._zoomSlideShow("next",n)}),o._handler(d,"click",function(){o._resizeZoomDialog(!0)}),o._handler(c,"click",function(){o._resizeZoomDialog(!1)}),o._handler(u,"click",function(){function e(e){var t=o.$modal.find(".kv-zoom-body"),i=o.zoomModalHeight;s.hasClass("file-zoom-fullscreen")&&(i=t.outerHeight(!0),e||(i-=a.outerHeight(!0))),t.css("height",e?i+e:i)}var t,a=s.find(".modal-header"),i=s.find(".modal-body .floating-buttons"),r=a.find(".kv-zoom-actions");a.is(":visible")?(t=a.outerHeight(!0),a.slideUp("slow",function(){r.find(".btn").appendTo(i),e(t)})):(i.find(".btn").appendTo(r),a.slideDown("slow",function(){e()})),s.focus()}),o._handler(s,"keydown",function(e){var t=e.which||e.keyCode,i=Z(this).find(".btn-prev"),a=Z(this).find(".btn-next"),r=Z(this).data("previewId"),n=o.rtl?39:37,e=o.rtl?37:39;t===n&&i.length&&!i.attr("disabled")&&o._zoomSlideShow("prev",r),t===e&&a.length&&!a.attr("disabled")&&o._zoomSlideShow("next",r)})},_zoomPreview:function(e){var t=this.$modal;if(!e.length)throw"Cannot zoom to detailed preview!";N.initModal(t),t.html(this._getModalContent()),e=e.closest(N.FRAMES),this._setZoomContent(e),t.modal("show"),this._initZoomButtons()},_zoomSlideShow:function(e,t){var i,a,r=this,n=r.$modal.find(".kv-zoom-actions .btn-"+e),o=r.getFrames().toArray(),l=o.length;if(!n.attr("disabled")){for(i=0;i<l;i++)if(Z(o[i]).attr("id")===t){a="prev"===e?i-1:i+1;break}a<0||l<=a||!o[a]||((n=Z(o[a])).length&&r._setZoomContent(n,!0),r._initZoomButtons(),r._raise("filezoom"+e,{previewId:t,modal:r.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var e=Z(this);t._handler(e,"click",function(){t._zoomPreview(e)})})},_inputFileCount:function(){return this.$element.get(0).files.length},_refreshPreview:function(){var e,t=this;(t._inputFileCount()||t.isAjaxUpload)&&t.showPreview&&t.isPreviewable&&(t.isAjaxUpload&&0<t.fileManager.count()?(e=Z.extend(!0,{},t.fileManager.stack),t.fileManager.clear(),t._clearFileInput()):e=t.$element.get(0).files,e&&e.length&&(t.readFiles(e),t._setFileDropZoneTitle()))},_clearObjects:function(e){e.find("video audio").each(function(){this.pause(),Z(this).remove()}),e.find("img object div").each(function(){Z(this).remove()})},_clearFileInput:function(){var e,t,i,a=this.$element;this._inputFileCount()&&(e=a.closest("form"),t=Z(document.createElement("form")),i=Z(document.createElement("div")),a.before(i),(e.length?e:i).after(t),t.append(a).trigger("reset"),i.before(a).remove(),t.remove())},_resetUpload:function(){var e=this;e.uploadCache={content:[],config:[],tags:[],append:!0},e.$btnUpload.removeAttr("disabled"),e._setProgress(0),e.$progress.hide(),e._resetErrors(!1),e._initAjax(),e.fileManager.clearImages(),e._resetCanvas(),e.cacheInitialPreview={},e.overwriteInitial&&(e.initialPreview=[],e.initialPreviewConfig=[],e.initialPreviewThumbTags=[],e.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var e=this;e.canvas&&e.imageCanvasContext&&e.imageCanvasContext.clearRect(0,0,e.canvas.width,e.canvas.height)},_hasInitialPreview:function(){return!this.overwriteInitial&&this.previewCache.count(!0)},_resetPreview:function(){var e,t=this;t.previewCache.count(!0)?(e=t.previewCache.out(),t._setPreviewContent(e.content),t._setInitThumbAttr(),e=t.initialCaption||e.caption,t._setCaption(e)):(t._clearPreview(),t._initCaption()),t.showPreview&&(t._initZoom(),t._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var e=this;e.showPreview&&!N.isEmpty(e.defaultPreviewContent)&&(e._setPreviewContent('<div class="file-default-preview">'+e.defaultPreviewContent+"</div>"),e.$container.removeClass("file-input-new"),e._initClickable())},_resetPreviewThumbs:function(e){var t=this;if(e)return t._clearPreview(),void t.clearFileStack();t._hasInitialPreview()?(e=t.previewCache.out(),t._setPreviewContent(e.content),t._setInitThumbAttr(),t._setCaption(e.caption),t._initPreviewActions()):t._clearPreview()},_getLayoutTemplate:function(e){e=this.layoutTemplates[e];return N.isEmpty(this.customLayoutTags)?e:N.replaceTags(e,this.customLayoutTags)},_getPreviewTemplate:function(e){e=this.previewTemplates[e];return N.isEmpty(this.customPreviewTags)?e:N.replaceTags(e,this.customPreviewTags)},_getOutData:function(e,t,i,a){var r=this;return t=t||{},i=i||{},{formdata:e,files:a=a||r.fileManager.list(),filenames:r.filenames,filescount:r.getFilesCount(),extra:r._getExtraData(),response:i,reader:r.reader,jqXHR:t}},_getMsgSelected:function(e){var t=1===e?this.fileSingle:this.filePlural;return 0<e?this.msgSelected.replace("{n}",e).replace("{files}",t):this.msgNoFilesSelected},_getFrame:function(e,t){t=N.getFrameElement(this.$preview,e,t);return t.length||this._log(N.logMessages.invalidThumb,{id:e}),t},_getZoom:function(e,t){t=N.getZoomElement(this.$preview,e,t);return t.length||this._log(N.logMessages.invalidThumb,{id:e}),t},_getThumbs:function(e){return e=e||"",this.getFrames(":not(.file-preview-initial)"+e)},_getThumbId:function(e){return this.previewInitId+"-"+e},_getExtraData:function(e,t){var i=this.uploadExtraData;return i="function"==typeof this.uploadExtraData?this.uploadExtraData(e,t):i},_initXhr:function(e,n,o){var l=this,s=l.fileManager,t=function(e){var t=0,i=e.total,a=e.loaded||e.position,r=s.getUploadStats(n,a,i);e.lengthComputable&&!l.enableResumableUpload&&(t=N.round(a/i*100)),n?l._setFileUploadStats(n,t,o,r):l._setProgress(t,null,null,l._getStats(r)),l._raise("fileajaxprogress",[r])};return e.upload&&(l.progressDelay&&(t=N.debounce(t,l.progressDelay)),e.upload.addEventListener("progress",t,!1)),e},_initAjaxSettings:function(){this._ajaxSettings=Z.extend(!0,{},this.ajaxSettings),this._ajaxDeleteSettings=Z.extend(!0,{},this.ajaxDeleteSettings)},_mergeAjaxCallback:function(e,t,i){var a,r=this._ajaxSettings,n=this.mergeAjaxCallbacks;"delete"===i&&(r=this._ajaxDeleteSettings,n=this.mergeAjaxDeleteCallbacks),a=r[e],r[e]=n&&"function"==typeof a?"before"===n?function(){a.apply(this,arguments),t.apply(this,arguments)}:function(){t.apply(this,arguments),a.apply(this,arguments)}:t},_ajaxSubmit:function(e,t,i,a,r,n,o,l){var s=this;s._raise("filepreajax",[r,n,o])&&(r.append("initialPreview",JSON.stringify(s.initialPreview)),r.append("initialPreviewConfig",JSON.stringify(s.initialPreviewConfig)),r.append("initialPreviewThumbTags",JSON.stringify(s.initialPreviewThumbTags)),s._initAjaxSettings(),s._mergeAjaxCallback("beforeSend",e),s._mergeAjaxCallback("success",t),s._mergeAjaxCallback("complete",i),s._mergeAjaxCallback("error",a),"function"==typeof(l=l||s.uploadUrlThumb||s.uploadUrl)&&(l=l()),"object"==typeof(o=s._getExtraData(n,o)||{})&&Z.each(o,function(e,t){r.append(e,t)}),l={xhr:function(){var e=Z.ajaxSettings.xhr();return s._initXhr(e,n,s.fileManager.count())},url:s._encodeURI(l),type:"POST",dataType:"json",data:r,cache:!1,processData:!1,contentType:!1},l=Z.extend(!0,{},l,s._ajaxSettings),s.ajaxQueue.push(l),l=function(){var e;s.ajaxCurrentThreads<s.maxAjaxThreads&&void 0!==(e=s.ajaxQueue.shift())&&(s.ajaxCurrentThreads++,e=Z.ajax(e).done(function(){clearInterval(s.ajaxQueueIntervalId),s.ajaxCurrentThreads--}),s.ajaxRequests.push(e))},s.ajaxQueueIntervalId=setInterval(l,s.queueDelay))},_mergeArray:function(e,t){var i=N.cleanArray(this[e]),t=N.cleanArray(t);this[e]=i.concat(t)},_initUploadSuccess:function(e,t,i){var a,r,n,o,l,s=this;s.showPreview&&"object"==typeof e&&!Z.isEmptyObject(e)&&void 0!==e.initialPreview&&0<e.initialPreview.length&&(s.hasInitData=!0,r=e.initialPreview||[],n=e.initialPreviewConfig||[],o=e.initialPreviewThumbTags||[],e=void 0===e.append||e.append,(r=0<r.length&&!N.isArray(r)?r.split(s.initialPreviewDelimiter):r).length&&(s._mergeArray("initialPreview",r),s._mergeArray("initialPreviewConfig",n),s._mergeArray("initialPreviewThumbTags",o)),void 0!==t?i?(l=t.attr("data-fileindex"),s.uploadCache.content[l]=r[0],s.uploadCache.config[l]=n[0]||[],s.uploadCache.tags[l]=o[0]||[],s.uploadCache.append=e):(l=s.previewCache.add(r[0],n[0],o[0],e),l=s.previewCache.get(l,!1),(l=(a=Z(document.createElement("div")).html(l).hide().insertAfter(t)).find(".kv-zoom-cache"))&&l.length&&l.insertAfter(t),t.fadeOut("slow",function(){var e=a.find(".file-preview-frame");e&&e.length&&e.insertBefore(t).fadeIn("slow").css("display:inline-block"),s._initPreviewActions(),s._clearFileInput(),N.cleanZoomCache(s._getZoom(t.attr("id"))),t.remove(),a.remove(),s._initSortable()})):(s.previewCache.set(r,n,o,e),s._initPreview(),s._initPreviewActions()))},_initSuccessThumbs:function(){var a=this;a.showPreview&&a._getThumbs(N.FRAMES+".file-preview-success").each(function(){var i=Z(this),e=i.find(".kv-file-remove");e.removeAttr("disabled"),a._handler(e,"click",function(){var e=i.attr("id"),t=a._raise("filesuccessremove",[e,i.attr("data-fileindex")]);N.cleanMemory(i),!1!==t&&i.fadeOut("slow",function(){N.cleanZoomCache(a._getZoom(e)),i.remove(),a.getFrames().length||a.reset()})})})},_updateInitialPreview:function(){var e,t,i=this,a=i.uploadCache,r=0,n=i.cacheInitialPreview;if(n&&n.content&&(r=n.content.length),i.showPreview){if(i.previewCache.set(a.content,a.config,a.tags,a.append),r){for(e=0;e<a.content.length;e++)t=e+r,n.content[t]=a.content[e],n.config.length&&(n.config[t]=a.config[e]),n.tags.length&&(n.tags[t]=a.tags[e]);i.initialPreview=N.cleanArray(n.content),i.initialPreviewConfig=N.cleanArray(n.config),i.initialPreviewThumbTags=N.cleanArray(n.tags)}else i.initialPreview=a.content,i.initialPreviewConfig=a.config,i.initialPreviewThumbTags=a.tags;i.cacheInitialPreview={},i.hasInitData&&(i._initPreview(),i._initPreviewActions())}},_uploadSingle:function(r,n,o){var l,s,e,d,t,c,u,i,p,a,f,g=this,m=g.fileManager,h=m.count(),v=new FormData,w=g._getThumbId(n),b=0<h||!Z.isEmptyObject(g.uploadExtraData),_=g.ajaxOperations.uploadThumb,C=m.getFile(n),y={id:w,index:r,fileId:n},x=g.fileManager.getFileName(n,!0);g.enableResumableUpload||(g.showPreview&&(s=g.fileManager.getThumb(n),u=s.find(".file-thumb-progress"),d=s.find(".kv-file-upload"),t=s.find(".kv-file-remove"),u.show()),0===h||!b||g.showPreview&&d&&d.hasClass("disabled")||g._abort(y)||(f=function(){c?m.errors.push(n):m.removeFile(n),m.setProcessed(n),m.isProcessed()&&(g.fileBatchCompleted=!0)},e=function(){var i;g.fileBatchCompleted&&setTimeout(function(){var e=0===m.count(),t=m.errors.length;g._updateInitialPreview(),g.unlock(e),e&&g._clearFileInput(),i=g.$preview.find(".file-preview-initial"),g.uploadAsync&&i.length&&(N.addCss(i,N.SORT_CSS),g._initSortable()),g._raise("filebatchuploadcomplete",[m.stack,g._getExtraData()]),g.retryErrorUploads&&0!==t||m.clear(),g._setProgress(101),g.ajaxAborted=!1},g.processDelay)},i=function(e){l=g._getOutData(v,e),m.initStats(n),g.fileBatchCompleted=!1,o||(g.ajaxAborted=!1),g.showPreview&&(s.hasClass("file-preview-success")||(g._setThumbStatus(s,"Loading"),N.addCss(s,"file-uploading")),d.attr("disabled",!0),t.attr("disabled",!0)),o||g.lock(),-1!==m.errors.indexOf(n)&&delete m.errors[n],g._raise("filepreupload",[l,w,r]),Z.extend(!0,y,l),g._abort(y)&&(e.abort(),o||(g._setThumbStatus(s,"New"),s.removeClass("file-uploading"),d.removeAttr("disabled"),t.removeAttr("disabled"),g.unlock()),g._setProgressCancelled())},a=function(e,t,i){var a=g.showPreview&&s.attr("id")?s.attr("id"):w;l=g._getOutData(v,i,e),Z.extend(!0,y,l),setTimeout(function(){N.isEmpty(e)||N.isEmpty(e.error)?(g.showPreview&&(g._setThumbStatus(s,"Success"),d.hide(),g._initUploadSuccess(e,s,o),g._setProgress(101,u)),g._raise("fileuploaded",[l,a,r]),o?f():g.fileManager.remove(s)):(c=!0,p=g._parseError(_,i,g.msgUploadError,g.fileManager.getFileName(n)),g._showFileError(p,y),g._setPreviewError(s,!0),g.retryErrorUploads||d.hide(),o&&f(),g._setProgress(101,g._getFrame(a).find(".file-thumb-progress"),g.msgUploadError))},g.processDelay)},h=function(){setTimeout(function(){g.showPreview&&(d.removeAttr("disabled"),t.removeAttr("disabled"),s.removeClass("file-uploading")),o?e():(g.unlock(!1),g._clearFileInput()),g._initSuccessThumbs()},g.processDelay)},b=function(e,t,i){p=g._parseError(_,e,i,g.fileManager.getFileName(n)),c=!0,setTimeout(function(){o&&f(),g.fileManager.setProgress(n,100),g._setPreviewError(s,!0),g.retryErrorUploads||d.hide(),Z.extend(!0,y,g._getOutData(v,e)),g._setProgress(101,u,g.msgAjaxProgressError.replace("{operation}",_)),g._setProgress(101,s.find(".file-thumb-progress"),g.msgUploadError),g._showFileError(p,y)},g.processDelay)},v.append(g.uploadFileAttr,C.file,x),g._setUploadData(v,{fileId:n}),g._ajaxSubmit(i,a,h,b,v,n,r)))},_uploadBatch:function(){var l,s,e,t,i,a,d=this,r=d.fileManager,n=r.total(),o=0<n||!Z.isEmptyObject(d.uploadExtraData),c=new FormData,u=d.ajaxOperations.uploadBatch;0!==n&&o&&!d._abort({})&&(s=function(){d.fileManager.clear(),d._clearFileInput()},e=function(e){d.lock(),r.initStats();var t=d._getOutData(c,e);d.ajaxAborted=!1,d.showPreview&&d._getThumbs().each(function(){var e=Z(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-success")||(d._setThumbStatus(e,"Loading"),N.addCss(e,"file-uploading")),t.attr("disabled",!0),i.attr("disabled",!0)}),d._raise("filebatchpreupload",[t]),d._abort(t)&&(e.abort(),d._getThumbs().each(function(){var e=Z(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-loading")&&(d._setThumbStatus(e,"New"),e.removeClass("file-uploading")),t.removeAttr("disabled"),i.removeAttr("disabled")}),d._setProgressCancelled())},t=function(e,t,i){var a=d._getOutData(c,i,e),r=0,n=d._getThumbs(":not(.file-preview-success)"),o=N.isEmpty(e)||N.isEmpty(e.errorkeys)?[]:e.errorkeys;N.isEmpty(e)||N.isEmpty(e.error)?(d._raise("filebatchuploadsuccess",[a]),s(),d.showPreview?(n.each(function(){var e=Z(this);d._setThumbStatus(e,"Success"),e.removeClass("file-uploading"),e.find(".kv-file-upload").hide().removeAttr("disabled")}),d._initUploadSuccess(e)):d.reset(),d._setProgress(101)):(d.showPreview&&(n.each(function(){var e=Z(this);e.removeClass("file-uploading"),e.find(".kv-file-upload").removeAttr("disabled"),e.find(".kv-file-remove").removeAttr("disabled"),0===o.length||-1!==Z.inArray(r,o)?(d._setPreviewError(e,!0),d.retryErrorUploads||(e.find(".kv-file-upload").hide(),d.fileManager.remove(e))):(e.find(".kv-file-upload").hide(),d._setThumbStatus(e,"Success"),d.fileManager.remove(e)),e.hasClass("file-preview-error")&&!d.retryErrorUploads||r++}),d._initUploadSuccess(e)),l=d._parseError(u,i,d.msgUploadError),d._showFileError(l,a,"filebatchuploaderror"),d._setProgress(101,d.$progress,d.msgUploadError))},i=function(){d.unlock(),d._initSuccessThumbs(),d._clearFileInput(),d._raise("filebatchuploadcomplete",[d.fileManager.stack,d._getExtraData()])},o=function(e,t,i){var a=d._getOutData(c,e);l=d._parseError(u,e,i),d._showFileError(l,a,"filebatchuploaderror"),d.uploadFileCount=n-1,d.showPreview&&(d._getThumbs().each(function(){var e=Z(this);e.removeClass("file-uploading"),d.fileManager.getFile(e.attr("data-fileid"))&&d._setPreviewError(e)}),d._getThumbs().removeClass("file-uploading"),d._getThumbs(" .kv-file-upload").removeAttr("disabled"),d._getThumbs(" .kv-file-delete").removeAttr("disabled"),d._setProgress(101,d.$progress,d.msgAjaxProgressError.replace("{operation}",u)))},a=0,Z.each(d.fileManager.stack,function(e,t){N.isEmpty(t.file)||c.append(d.uploadFileAttr,t.file,t.nameFmt||"untitled_"+a),a++}),d._ajaxSubmit(e,t,i,o,c))},_uploadExtraOnly:function(){var e,t,i,a,r,n=this,o={},l=new FormData,s=n.ajaxOperations.uploadExtra;n._abort(o)||(e=function(e){n.lock();var t=n._getOutData(l,e);n._raise("filebatchpreupload",[t]),n._setProgress(50),o.data=t,o.xhr=e,n._abort(o)&&(e.abort(),n._setProgressCancelled())},t=function(e,t,i){var a=n._getOutData(l,i,e);N.isEmpty(e)||N.isEmpty(e.error)?(n._raise("filebatchuploadsuccess",[a]),n._clearFileInput(),n._initUploadSuccess(e),n._setProgress(101)):(r=n._parseError(s,i,n.msgUploadError),n._showFileError(r,a,"filebatchuploaderror"))},i=function(){n.unlock(),n._clearFileInput(),n._raise("filebatchuploadcomplete",[n.fileManager.stack,n._getExtraData()])},a=function(e,t,i){var a=n._getOutData(l,e);r=n._parseError(s,e,i),o.data=a,n._showFileError(r,a,"filebatchuploaderror"),n._setProgress(101,n.$progress,n.msgAjaxProgressError.replace("{operation}",s))},n._ajaxSubmit(e,t,i,a,l))},_deleteFileIndex:function(e){var t=this,i=e.attr("data-fileindex"),e=t.reversePreviewOrder;i.substring(0,5)===N.INIT_FLAG&&(i=parseInt(i.replace(N.INIT_FLAG,"")),t.initialPreview=N.spliceArray(t.initialPreview,i,e),t.initialPreviewConfig=N.spliceArray(t.initialPreviewConfig,i,e),t.initialPreviewThumbTags=N.spliceArray(t.initialPreviewThumbTags,i,e),t.getFrames().each(function(){var e=Z(this),t=e.attr("data-fileindex");t.substring(0,5)===N.INIT_FLAG&&(t=parseInt(t.replace(N.INIT_FLAG,"")),i<t&&(t--,e.attr("data-fileindex",N.INIT_FLAG+t)))}),(t.uploadAsync||t.enableResumableUpload)&&(t.cacheInitialPreview=t.getPreview()))},_initFileActions:function(){var s=this;s.showPreview&&(s._initZoomButton(),s.getFrames(" .kv-file-remove").each(function(){var a,r,e=Z(this),n=e.closest(N.FRAMES),o=n.attr("id"),l=n.attr("data-fileindex");s._handler(e,"click",function(){return!(!1===s._raise("filepreremove",[o,l])||!s._validateMinCount())&&(a=n.hasClass("file-preview-error"),N.cleanMemory(n),void n.fadeOut("slow",function(){N.cleanZoomCache(s._getZoom(o)),s.fileManager.remove(n),s._clearObjects(n),n.remove(),o&&a&&s.$errorContainer.find('li[data-thumb-id="'+o+'"]').fadeOut("fast",function(){Z(this).remove(),s._errorsExist()||s._resetErrors()}),s._clearFileInput();var e=s.previewCache.count(!0),t=s.fileManager.count(),i=s.showPreview&&s.getFrames().length;0!==t||0!==e||i?(r=1<(r=e+t)?s._getMsgSelected(r):(t=s.fileManager.getFirstFile())?t.nameFmt:"_",s._setCaption(r)):s.reset(),s._raise("fileremoved",[o,l])}))})}),s.getFrames(" .kv-file-upload").each(function(){var i=Z(this);s._handler(i,"click",function(){var e=i.closest(N.FRAMES),t=e.attr("data-fileid");s.$progress.hide(),e.hasClass("file-preview-error")&&!s.retryErrorUploads||s._uploadSingle(s.fileManager.getIndex(t),t,!1)})}))},_initPreviewActions:function(){function g(){var e=m.isAjaxUpload?m.previewCache.count(!0):m._inputFileCount();m.getFrames().length||e||(m._setCaption(""),m.reset(),m.initialCaption="")}var m=this,e=m.$preview,h=m.deleteExtraData||{},t=N.FRAMES+" .kv-file-remove",i=m.fileActionSettings,v=i.removeClass,w=i.removeErrorClass;m._initZoomButton(),e.find(t).each(function(){var r,e,n,t,i,o,l,a,s,d,c=Z(this),u=c.data("url")||m.deleteUrl,p=c.data("key"),f=m.ajaxOperations.deleteThumb;N.isEmpty(u)||void 0===p||("function"==typeof u&&(u=u()),n=c.closest(N.FRAMES),t=m.previewCache.data,l=n.attr("data-fileindex"),l=parseInt(l.replace(N.INIT_FLAG,"")),a=N.isEmpty(t.config)&&N.isEmpty(t.config[l])?null:t.config[l],s=N.isEmpty(a)||N.isEmpty(a.extra)?h:a.extra,d=a.filename||a.caption||"","function"==typeof s&&(s=s()),o={id:c.attr("id"),key:p,extra:s},e=function(e){m.ajaxAborted=!1,m._raise("filepredelete",[p,e,s]),m._abort()?e.abort():(c.removeClass(w),N.addCss(n,"file-uploading"),N.addCss(c,"disabled "+v))},t=function(e,t,i){var a;if(!N.isEmpty(e)&&!N.isEmpty(e.error))return o.jqXHR=i,o.response=e,r=m._parseError(f,i,m.msgDeleteError,d),m._showFileError(r,o,"filedeleteerror"),n.removeClass("file-uploading"),c.removeClass("disabled "+v).addClass(w),void g();n.removeClass("file-uploading").addClass("file-deleted"),n.fadeOut("slow",function(){l=parseInt(n.attr("data-fileindex").replace(N.INIT_FLAG,"")),m.previewCache.unset(l),m._deleteFileIndex(n),a=m.previewCache.count(!0),a=0<a?m._getMsgSelected(a):"",m._setCaption(a),m._raise("filedeleted",[p,i,s]),N.cleanZoomCache(m._getZoom(n.attr("id"))),m._clearObjects(n),n.remove(),g()})},a=function(e,t,i){i=m._parseError(f,e,i,d);o.jqXHR=e,o.response={},m._showFileError(i,o,"filedeleteerror"),n.removeClass("file-uploading"),c.removeClass("disabled "+v).addClass(w),g()},m._initAjaxSettings(),m._mergeAjaxCallback("beforeSend",e,"delete"),m._mergeAjaxCallback("success",t,"delete"),m._mergeAjaxCallback("error",a,"delete"),i=Z.extend(!0,{},{url:m._encodeURI(u),type:"POST",dataType:"json",data:Z.extend(!0,{},{key:p},s)},m._ajaxDeleteSettings),m._handler(c,"click",function(){return!!m._validateMinCount()&&(m.ajaxAborted=!1,m._raise("filebeforedelete",[p,s]),void(m.ajaxAborted instanceof Promise?m.ajaxAborted.then(function(e){e||Z.ajax(i)}):m.ajaxAborted||Z.ajax(i)))}))})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){N.addCss(this.$captionContainer,"icon-visible")},_getSize:function(e,t){var i,a=parseFloat(e),r=this.fileSizeGetter;return Z.isNumeric(e)&&Z.isNumeric(a)?(i="function"==typeof r?r(a):0===a?"0.00 B":(i=Math.floor(Math.log(a)/Math.log(1024)),t=t||["B","KB","MB","GB","TB","PB","EB","ZB","YB"],+(a/Math.pow(1024,i)).toFixed(2)+" "+t[i]),this._getLayoutTemplate("size").replace("{sizeText}",i)):""},_getFileType:function(e){return this.mimeTypeAliases[e]||e},_generatePreviewTemplate:function(o,e,l,s,d,c,t,i,u,a,p,f,g,r){var m=this,h=m.slug(l),n="",v="",w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,b=h,_=h,C="type-default",y=a||m._renderFileFooter(o,h,i,"auto",t),a=m.preferIconicPreview,i=m.preferIconicZoomPreview,t=a?"other":o,t=w<400?m.previewSettingsSmall[t]||m.defaults.previewSettingsSmall[t]:m.previewSettings[t]||m.defaults.previewSettings[t];return t&&Z.each(t,function(e,t){v+=e+":"+t+";"}),t=function(e,t,i,a){var r=i?"zoom-"+d:d,n=m._getPreviewTemplate(e),a=(u||"")+" "+a;return m.frameClass&&(a=m.frameClass+" "+a),i&&(a=a.replace(" "+N.SORT_CSS,"")),n=m._parseFilePreviewIcon(n,l),"text"===e&&(t=N.htmlEncode(t)),"object"!==o||s||Z.each(m.defaults.fileTypeSettings,function(e,t){"object"!==e&&"other"!==e&&t(l,s)&&(C="type-"+e)}),N.isEmpty(g)||(void 0!==g.title&&null!==g.title&&(b=g.title),void 0!==g.alt&&null!==g.alt&&(b=g.alt)),n.setTokens({previewId:r,caption:h,title:b,alt:_,frameClass:a,type:m._getFileType(s),fileindex:p,fileid:c||"",typeCss:C,footer:y,data:t,template:f||o,style:v?'style="'+v+'"':""})},p=p||d.slice(d.lastIndexOf("-")+1),m.fileActionSettings.showZoom&&(n=t(i?"other":o,r||e,!0,"kv-zoom-thumb")),n="\n"+m._getLayoutTemplate("zoomCache").replace("{zoomContent}",n),"function"==typeof m.sanitizeZoomCache&&(n=m.sanitizeZoomCache(n)),t(a?"other":o,e,!1,"kv-preview-thumb")+n},_addToPreview:function(e,t){return this.reversePreviewOrder?e.prepend(t):e.append(t)},_previewDefault:function(e,t){var i,a,r,n,o,l,s,d=this,c=d.$preview;d.showPreview&&(i=N.getFileName(e),a=e?e.type:"",r=e.size||0,n=d._getFileName(e,""),o=!0===t&&!d.isAjaxUpload,l=N.createObjectURL(e),s=d.fileManager.getId(e),e=d._getThumbId(s),d._clearDefaultPreview(),o=d._generatePreviewTemplate("other",l,i,a,e,s,o,r),d._addToPreview(c,o),d._setThumbAttr(e,n,r),!0===t&&d.isAjaxUpload&&d._setThumbStatus(d._getFrame(e),"Error"))},_previewFile:function(e,t,i,a,r){var n,o,l,s,d,c,u;this.showPreview&&(n=this,u=N.getFileName(t),o=r.type,l=r.name,s=n._parseFileType(o,u),d=n.$preview,c=t.size||0,r="text"===s||"html"===s||"image"===s?i.target.result:a,i=n.fileManager.getId(t),a=n._getThumbId(i),"html"===s&&n.purifyHtml&&window.DOMPurify&&(r=window.DOMPurify.sanitize(r)),u=n._generatePreviewTemplate(s,r,u,o,a,i,!1,c),n._clearDefaultPreview(),n._addToPreview(d,u),u=n._getFrame(a),n._validateImageOrientation(u.find("img"),t,a,i,l,o,c,r),n._setThumbAttr(a,l,c),n._initSortable())},_setThumbAttr:function(e,t,i){e=this._getFrame(e);e.length&&(i=i&&0<i?this._getSize(i):"",e.data({caption:t,size:i}))},_setInitThumbAttr:function(){var e,t,i,a=this.previewCache.data,r=this.previewCache.count(!0);if(0!==r)for(var n=0;n<r;n++)t=a.config[n],i=this.previewInitId+"-"+N.INIT_FLAG+n,e=N.ifSet("caption",t,N.ifSet("filename",t)),t=N.ifSet("size",t),this._setThumbAttr(i,e,t)},_slugDefault:function(e){return N.isEmpty(e)?"":String(e).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_updateFileDetails:function(e){var t=this,i=t.$element,a=N.isIE(9)&&N.findFileName(i.val())||i[0].files[0]&&i[0].files[0].name,r=!a&&0<t.fileManager.count()?t.fileManager.getFirstFile().nameFmt:a?t.slug(a):"_",i=t.isAjaxUpload?t.fileManager.count():e,a=t.previewCache.count(!0)+i,a=1===i?r:t._getMsgSelected(a);t.isError?(t.$previewContainer.removeClass("file-thumb-loading"),t.$previewStatus.html(""),t.$captionContainer.removeClass("icon-visible")):t._showFileIcon(),t._setCaption(a,t.isError),t.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&t._raise("fileselect",[e,r]),t.previewCache.count(!0)&&t._initPreviewActions()},_setThumbStatus:function(e,t){var i,a,r,n,o;this.showPreview&&(a=(i="indicator"+t)+"Title",r="file-preview-"+t.toLowerCase(),n=e.find(".file-upload-indicator"),o=this.fileActionSettings,e.removeClass("file-preview-success file-preview-error file-preview-paused file-preview-loading"),"Success"===t&&e.find(".file-drag-handle").remove(),n.html(o[i]),n.attr("title",o[a]),e.addClass(r),"Error"!==t||this.retryErrorUploads||e.find(".kv-file-upload").attr("disabled",!0))},_setProgressCancelled:function(){this._setProgress(101,this.$progress,this.msgCancelled)},_setProgress:function(e,t,i,a){var r,n,o,l=this;(t=t||l.$progress).length&&(r=Math.min(e,100),n=l.progressUploadThreshold,o=e<=100?l.progressTemplate:l.progressCompleteTemplate,o=r<100?l.progressTemplate:i?l.paused?l.progressPauseTemplate:l.progressErrorTemplate:o,100<=e&&(a=""),N.isEmpty(o)||(a=a||"",r=(r=n&&n<r&&e<=100?o.setTokens({percent:n,status:l.msgUploadThreshold}):o.setTokens({percent:r,status:100<e?l.msgUploadEnd:r+"%"})).setTokens({stats:a}),t.html(r),i&&t.find('[role="progressbar"]').html(i)))},_setFileDropZoneTitle:function(){var e,t=this,i=t.$container.find(".file-drop-zone"),a=t.dropZoneTitle;t.isClickable&&(e=N.isEmpty(t.$element.attr("multiple"))?t.fileSingle:t.filePlural,a+=t.dropZoneClickTitle.replace("{files}",e)),i.find("."+t.dropZoneTitleClass).remove(),!t.showPreview||0===i.length||0<t.fileManager.count()||!t.dropZoneEnabled||!t.isAjaxUpload&&t.$element.files||(0===i.find(N.FRAMES).length&&N.isEmpty(t.defaultPreviewContent)&&i.prepend('<div class="'+t.dropZoneTitleClass+'">'+a+"</div>"),t.$container.removeClass("file-input-new"),N.addCss(t.$container,"file-input-ajax-new"))},_getStats:function(e){var t,i;return this.showUploadStats&&e&&e.bitrate?(i=this._getLayoutTemplate("stats"),t=e.elapsed&&e.bps?this.msgPendingTime.setTokens({time:N.getElapsed(Math.ceil(e.pendingBytes/e.bps))}):this.msgCalculatingTime,i.setTokens({uploadSpeed:e.bitrate,pendingTime:t})):""},_setResumableProgress:function(e,t,i){var a=this.resumableManager,a=i?a:this,i=i?i.find(".file-thumb-progress"):null;0===a.lastProgress&&(a.lastProgress=e),e<a.lastProgress&&(e=a.lastProgress),this._setProgress(e,i,null,this._getStats(t)),a.lastProgress=e},_setFileUploadStats:function(e,t,i,a){var r,n,o,l,s,d,c,u,p,f=this,g=f.$progress;(f.showPreview||g&&g.length)&&(n=(r=f.fileManager).getThumb(e),p=f.resumableManager,o=0,l=r.getTotalSize(),s=Z.extend(!0,{},a),f.enableResumableUpload?(d=a.loaded,c=p.getUploadedSize(),u=p.file.size,d+=c,p=r.uploadedSize+d,t=N.round(100*d/u),a.pendingBytes=u-c,f._setResumableProgress(t,a,n),c=Math.floor(100*p/l),s.pendingBytes=l-p,f._setResumableProgress(c,s)):(r.setProgress(e,t),g=n&&n.length?n.find(".file-thumb-progress"):null,f._setProgress(t,g,null,f._getStats(a)),Z.each(r.stats,function(e,t){o+=t.loaded}),s.pendingBytes=l-o,c=N.round(o/l*100),f._setProgress(c,null,null,f._getStats(s))))},_validateMinCount:function(){var e=this,t=e.isAjaxUpload?e.fileManager.count():e._inputFileCount();return!(e.validateInitialCount&&0<e.minFileCount&&e._getFileCount(t-1)<e.minFileCount)||(e._noFilesError({}),!1)},_getFileCount:function(e){return this.validateInitialCount&&!this.overwriteInitial&&(e+=this.previewCache.count(!0)),e},_getFileId:function(e){return N.getFileId(e,this.generateFileId)},_getFileName:function(e,t){e=N.getFileName(e);return e?this.slug(e):t},_getFileNames:function(t){return this.filenames.filter(function(e){return t?void 0!==e:null!=e})},_setPreviewError:function(e,t){var i=this,a=i.removeFromPreviewOnError&&!i.retryErrorUploads;t&&!a||i.fileManager.remove(e),i.showPreview&&(a?e.remove():(i._setThumbStatus(e,"Error"),i._refreshUploadButton(e)))},_refreshUploadButton:function(e){var t=e.find(".kv-file-upload"),i=this.fileActionSettings,a=i.uploadIcon,e=i.uploadTitle;t.length&&(this.retryErrorUploads&&(a=i.uploadRetryIcon,e=i.uploadRetryTitle),t.attr("title",e).html(a))},_checkDimensions:function(e,t,i,a,r,n,o){var l=this[("Small"===t?"min":"max")+"Image"+n];!N.isEmpty(l)&&i.length&&(i=i[0],i="Width"===n?i.naturalWidth||i.width:i.naturalHeight||i.height,("Small"===t?l<=i:i<=l)||(l=this["msgImage"+n+t].setTokens({name:r,size:l}),this._showFileError(l,o),this._setPreviewError(a)))},_getExifObj:function(e){var t=null,i=N.logMessages.exifWarning;if("data:image/jpeg;base64,"===e.slice(0,23)||"data:image/jpg;base64,"===e.slice(0,22)){try{t=window.piexif?window.piexif.load(e):null}catch(e){t=null,i=e&&e.message||""}return t||this._log(N.logMessages.badExifParser,{details:i}),t}t=null},setImageOrientation:function(o,l,s,d){var c,u,p=this,e=!o||!o.length,t=!l||!l.length,f=!1,g=e&&d&&"image"===d.attr("data-template");e&&t||(t="load.fileinputimageorient",g?(o=l,l=null,o.css(p.previewSettings.image),u=Z(document.createElement("div")).appendTo(d.find(".kv-file-content")),c=Z(document.createElement("span")).insertBefore(o),o.css("visibility","hidden").removeClass("file-zoom-detail").appendTo(u)):f=!o.is(":visible"),o.off(t).on(t,function(){f&&(p.$preview.removeClass("hide-content"),d.find(".kv-file-content").css("visibility","hidden"));var e=o.get(0),t=l&&l.length?l.get(0):null,i=e.offsetHeight,a=e.offsetWidth,r=N.getRotation(s);if(f&&(d.find(".kv-file-content").css("visibility","visible"),p.$preview.addClass("hide-content")),o.data("orientation",s),t&&l.data("orientation",s),s<5)return N.setTransform(e,r),void N.setTransform(t,r);var n=Math.atan(a/i),a=Math.sqrt(Math.pow(i,2)+Math.pow(a,2)),a=a?i/Math.cos(Math.PI/2+n)/a:1,a=" scale("+Math.abs(a)+")";N.setTransform(e,r+a),N.setTransform(t,r+a),g&&(o.css("visibility","visible").insertAfter(c).addClass("file-zoom-detail"),c.remove(),u.remove())}))},_validateImageOrientation:function(e,t,i,a,r,n,o,l){var s=this,d=s.autoOrientImage,c=N.getZoomSelector(i," img"),u=d?s._getExifObj(l):null,d=u?u["0th"][piexif.ImageIFD.Orientation]:null;d&&(s.setImageOrientation(e,Z(c),d,s._getFrame(i)),s._raise("fileimageoriented",{$img:e,file:t})),s._validateImage(i,a,r,n,o,l,u)},_validateImage:function(e,t,i,a,r,n,o){var l,s=this,d=s.$preview,c=s._getFrame(e),u=c.attr("data-fileindex"),p=c.find("img");i=i||"Untitled",p.one("load",function(){l=c.width(),d.width()<l&&p.css("width","100%"),l={ind:u,id:e,fileId:t},s._checkDimensions(u,"Small",p,c,i,"Width",l),s._checkDimensions(u,"Small",p,c,i,"Height",l),s.resizeImage||(s._checkDimensions(u,"Large",p,c,i,"Width",l),s._checkDimensions(u,"Large",p,c,i,"Height",l)),s._raise("fileimageloaded",[e]),s.fileManager.addImage(t,{ind:u,img:p,thumb:c,pid:e,typ:a,siz:r,validated:!1,imgData:n,exifObj:o}),c.data("exif",o),s._validateAllImages()}).one("error",function(){s._raise("fileimageloaderror",[e])}).each(function(){this.complete?Z(this).trigger("load"):this.error&&Z(this).trigger("error")})},_validateAllImages:function(){var i,a=this,r={val:0},n=a.fileManager.getImageCount(),o=a.resizeIfSizeMoreThan;n===a.fileManager.totalImages&&(a._raise("fileimagesloaded"),a.resizeImage&&Z.each(a.fileManager.loadedImages,function(e,t){t.validated||((i=t.siz)&&1e3*o<i&&a._getResizedImage(e,t,r,n),t.validated=!0)}))},_getResizedImage:function(e,t,i,a){var r,n,o=this,l=Z(t.img)[0],s=l.naturalWidth,d=l.naturalHeight,c=1,u=o.maxImageWidth||s,p=o.maxImageHeight||d,f=!(!s||!d),g=o.imageCanvas,m=o.imageCanvasContext,h=t.typ,v=t.pid,w=t.ind,b=t.thumb,_=t.exifObj,C=function(e,t,i){o.isAjaxUpload?o._showFileError(e,t,i):o._showError(e,t,i),o._setPreviewError(b)},t=o.fileManager.getFile(e),y={id:v,index:w,fileId:e},x=[e,v,w];if(t&&f&&!(s<=u&&d<=p)||(f&&t&&o._raise("fileimageresized",x),i.val++,i.val===a&&o._raise("fileimagesresized"),f)){h=h||o.resizeDefaultImageType,t=u<s,f=p<d,c="width"===o.resizePreference?t?u/s:f?p/d:1:f?p/d:t?u/s:1,o._resetCanvas(),s*=c,d*=c,g.width=s,g.height=d;try{m.drawImage(l,0,0,s,d),r=g.toDataURL(h,o.resizeQuality),_&&(n=window.piexif.dump(_),r=window.piexif.insert(n,r)),r=N.dataURI2Blob(r),o.fileManager.setFile(e,r),o._raise("fileimageresized",x),i.val++,i.val===a&&o._raise("fileimagesresized",[void 0,void 0]),r instanceof Blob||C(o.msgImageResizeError,y,"fileimageresizeerror")}catch(e){i.val++,i.val===a&&o._raise("fileimagesresized",[void 0,void 0]),C(o.msgImageResizeException.replace("{errors}",e.message),y,"fileimageresizeexception")}}else C(o.msgImageResizeError,y,"fileimageresizeerror")},_initBrowse:function(e){var t=this.$element;this.showBrowse?this.$btnFile=e.find(".btn-file").append(t):(t.appendTo(e).attr("tabindex",-1),N.addCss(t,"file-no-browse"))},_initClickable:function(){var t,e,i=this;i.isClickable&&(t=i.$dropZone,i.isAjaxUpload||(e=i.$preview.find(".file-default-preview")).length&&(t=e),N.addCss(t,"clickable"),t.attr("tabindex",-1),i._handler(t,"click",function(e){e=Z(e.target);Z(i.elErrorContainer+":visible").length||e.parents(".file-preview-thumbnails").length&&!e.parents(".file-default-preview").length||(i.$element.data("zoneClicked",!0).trigger("click"),t.blur())}))},_initCaption:function(){var e=this.initialCaption||"";return this.overwriteInitial||N.isEmpty(e)?(this.$caption.val(""),!1):(this._setCaption(e),!0)},_setCaption:function(e,t){var i,a,r,n=this;if(n.$caption.length){if(n.$captionContainer.removeClass("icon-visible"),t)i=Z("<div>"+n.msgValidationError+"</div>").text(),r=(a=n.fileManager.count())?(r=n.fileManager.getFirstFile(),1===a&&r?r.nameFmt:n._getMsgSelected(a)):n._getMsgSelected(n.msgNo),a=N.isEmpty(e)?r:e,r='<span class="'+n.msgValidationErrorClass+'">'+n.msgValidationErrorIcon+"</span>";else{if(N.isEmpty(e))return;a=i=Z("<div>"+e+"</div>").text(),r=n._getLayoutTemplate("fileIcon")}n.$captionContainer.addClass("icon-visible"),n.$caption.attr("title",i).val(a),n.$captionIcon.html(r)}},_createContainer:function(){var e=this,t={class:"file-input file-input-new"+(e.rtl?" kv-rtl":"")},t=Z(document.createElement("div")).attr(t).html(e._renderMain());return t.insertBefore(e.$element),e._initBrowse(t),e.theme&&t.addClass("theme-"+e.theme),t},_refreshContainer:function(){var e=this,t=e.$container;e.$element.insertAfter(t),t.html(e._renderMain()),e._initBrowse(t),e._validateDisabled()},_validateDisabled:function(){this.$caption.attr({readonly:this.isDisabled})},_renderMain:function(){var e=this,t=e.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=e.showClose?e._getLayoutTemplate("close"):"",a=e.showPreview?e._getLayoutTemplate("preview").setTokens({class:e.previewClass,dropClass:t}):"",t=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,t=e.captionTemplate.setTokens({class:t+" kv-fileinput-caption"});return e.mainTemplate.setTokens({class:e.mainClass+(!e.showBrowse&&e.showCaption?" no-browse":""),preview:a,close:i,caption:t,upload:e._renderButton("upload"),remove:e._renderButton("remove"),cancel:e._renderButton("cancel"),pause:e._renderButton("pause"),browse:e._renderButton("browse")})},_renderButton:function(e){var t=this,i=t._getLayoutTemplate("btnDefault"),a=t[e+"Class"],r=t[e+"Title"],n=t[e+"Icon"],o=t[e+"Label"],l=t.isDisabled?" disabled":"",s="button";switch(e){case"remove":if(!t.showRemove)return"";break;case"cancel":if(!t.showCancel)return"";a+=" kv-hidden";break;case"pause":if(!t.showPause)return"";a+=" kv-hidden";break;case"upload":if(!t.showUpload)return"";t.isAjaxUpload&&!t.isDisabled?i=t._getLayoutTemplate("btnLink").replace("{href}",t.uploadUrl):s="submit";break;case"browse":if(!t.showBrowse)return"";i=t._getLayoutTemplate("btnBrowse");break;default:return""}return a+="browse"===e?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button",N.isEmpty(o)||(o=' <span class="'+t.buttonLabelClass+'">'+o+"</span>"),i.setTokens({type:s,css:a,title:r,status:l,icon:n,label:o})},_renderThumbProgress:function(){return'<div class="file-thumb-progress kv-hidden">'+this.progressInfoTemplate.setTokens({percent:101,status:this.msgUploadBegin,stats:""})+"</div>"},_renderFileFooter:function(e,t,i,a,r){var n=this,o=n.fileActionSettings,l=o.showRemove,s=o.showDrag,d=o.showUpload,c=o.showZoom,u=n._getLayoutTemplate("footer"),p=n._getLayoutTemplate("indicator"),f=r?o.indicatorError:o.indicatorNew,o=r?o.indicatorErrorTitle:o.indicatorNewTitle,o=p.setTokens({indicator:f,indicatorTitle:o}),o={type:e,caption:t,size:i=n._getSize(i),width:a,progress:"",indicator:o};return n.isAjaxUpload?(o.progress=n._renderThumbProgress(),o.actions=n._renderFileActions(o,d,!1,l,c,s,!1,!1,!1)):o.actions=n._renderFileActions(o,!1,!1,!1,c,s,!1,!1,!1),o=u.setTokens(o),o=N.replaceTags(o,n.previewThumbTags)},_renderFileActions:function(e,t,i,a,r,n,o,l,s,d,c,u){var p=this;if(!e.type&&d&&(e.type="image"),p.enableResumableUpload?t=!1:"function"==typeof t&&(t=t(e)),"function"==typeof i&&(i=i(e)),"function"==typeof a&&(a=a(e)),"function"==typeof r&&(r=r(e)),"function"==typeof n&&(n=n(e)),!(t||i||a||r||n))return"";var f=!1===l?"":' data-url="'+l+'"',g="",m="",h=!1===s?"":' data-key="'+s+'"',v="",w="",b="",_=p._getLayoutTemplate("actions"),e=p.fileActionSettings,l=p.otherActionButtons.setTokens({dataKey:h,key:s}),o=o?e.removeClass+" disabled":e.removeClass;return a&&(v=p._getLayoutTemplate("actionDelete").setTokens({removeClass:o,removeIcon:e.removeIcon,removeTitle:e.removeTitle,dataUrl:f,dataKey:h,key:s})),t&&(w=p._getLayoutTemplate("actionUpload").setTokens({uploadClass:e.uploadClass,uploadIcon:e.uploadIcon,uploadTitle:e.uploadTitle})),i&&(b=(b=p._getLayoutTemplate("actionDownload").setTokens({downloadClass:e.downloadClass,downloadIcon:e.downloadIcon,downloadTitle:e.downloadTitle,downloadUrl:c||p.initialPreviewDownloadUrl})).setTokens({filename:u,key:s})),r&&(g=p._getLayoutTemplate("actionZoom").setTokens({zoomClass:e.zoomClass,zoomIcon:e.zoomIcon,zoomTitle:e.zoomTitle})),n&&d&&(d="drag-handle-init "+e.dragClass,m=p._getLayoutTemplate("actionDrag").setTokens({dragClass:d,dragTitle:e.dragTitle,dragIcon:e.dragIcon})),_.setTokens({delete:v,upload:w,download:b,zoom:g,drag:m,other:l})},_browse:function(e){var t=this;e&&e.isDefaultPrevented()||!t._raise("filebrowse")||(t.isError&&!t.isAjaxUpload&&t.clear(),t.$captionContainer.focus())},_change:function(e){var t=this;if(!t.changeTriggered){var i,a,r,n,o,l=t.$element,s=1<arguments.length,d=t.isAjaxUpload,c=s?arguments[1]:l.get(0).files,u=!d&&N.isEmpty(l.attr("multiple"))?1:t.maxFileCount,p=t.fileManager.count(),f=N.isEmpty(l.attr("multiple"))&&0<p;if(t.reader=null,t._resetUpload(),t._hideFileIcon(),t.dropZoneEnabled&&t.$container.find(".file-drop-zone ."+t.dropZoneTitleClass).remove(),s=c=!d?e.target&&void 0===e.target.files?e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files||{}:c,N.isEmpty(s)||0===s.length)return d||t.clear(),void t._raise("fileselectnone");if(t._resetErrors(),l=s.length,e=t._getFileCount(d?t.fileManager.count()+l:l),0<u&&u<e){if(!t.autoReplace||u<l)return i=t.autoReplace&&u<l?l:e,a=u,o=t.msgFilesTooMany.replace("{m}",a).replace("{n}",i),t.isError=(r=o,i=a=n=null,o=Z.extend(!0,{},t._getOutData(null,{},{},c),{id:a,index:i}),n={id:a,index:i,file:n,files:c},d?t._showFileError(r,o):t._showError(r,n)),t.$captionContainer.removeClass("icon-visible"),t._setCaption("",!0),void t.$container.removeClass("file-input-new file-input-ajax-new");u<e&&t._resetPreviewThumbs(d)}else!d||f?(t._resetPreviewThumbs(!1),f&&t.clearFileStack()):!d||0!==p||t.previewCache.count(!0)&&!t.overwriteInitial||t._resetPreviewThumbs(!0);t.readFiles(s)}},_abort:function(e){var t=this;return t.ajaxAborted&&"object"==typeof t.ajaxAborted&&void 0!==t.ajaxAborted.message?((e=Z.extend(!0,{},t._getOutData(null),e)).abortData=t.ajaxAborted.data||{},e.abortMessage=t.ajaxAborted.message,t._setProgress(101,t.$progress,t.msgCancelled),t._showFileError(t.ajaxAborted.message,e,"filecustomerror"),t.cancel(),!0):!!t.ajaxAborted},_resetFileStack:function(){var a=this,r=0;a._getThumbs().each(function(){var e=Z(this),t=e.attr("data-fileindex"),i=e.attr("id");"-1"!==t&&-1!==t&&(a.fileManager.getFile(e.attr("data-fileid"))?e.attr({"data-fileindex":"-1"}):(e.attr({"data-fileindex":r}),r++),a._getZoom(i).attr({"data-fileindex":e.attr("data-fileindex")}))})},_isFileSelectionValid:function(e){var t=this;return e=e||0,t.required&&!t.getFilesCount()?(t.$errorContainer.html(""),t._showFileError(t.msgFileRequired),!1):!(0<t.minFileCount&&t._getFileCount(e)<t.minFileCount)||(t._noFilesError({}),!1)},_canPreview:function(e){var t=this;if(!(e&&t.showPreview&&t.$preview&&t.$preview.length))return!1;var i=e.name||"",a=e.type||"",r=(e.size||0)/1e3,n=t._parseFileType(a,i),o=t.allowedPreviewTypes,l=t.allowedPreviewMimeTypes,s=t.allowedPreviewExtensions||[],d=t.disabledPreviewTypes,c=t.disabledPreviewMimeTypes,u=t.disabledPreviewExtensions||[],p=t.maxFilePreviewSize&&parseFloat(t.maxFilePreviewSize)||0,e=new RegExp("\\.("+s.join("|")+")$","i"),t=new RegExp("\\.("+u.join("|")+")$","i"),o=!o||-1!==o.indexOf(n),l=!l||-1!==l.indexOf(a),e=!s.length||N.compare(i,e);return!(d&&-1!==d.indexOf(n)||c&&-1!==c.indexOf(a)||u.length&&N.compare(i,t)||p&&!isNaN(p)&&p<r)&&(o||l||e)},clearFileStack:function(){var e=this;return e.fileManager.clear(),e._initResumableUpload(),e.enableResumableUpload?(null===e.showPause&&(e.showPause=!0),null===e.showCancel&&(e.showCancel=!1)):(e.showPause=!1,null===e.showCancel&&(e.showCancel=!0)),e.$element},getFileStack:function(){return this.fileManager.stack},getFileList:function(){return this.fileManager.list()},getFilesCount:function(){var e=this.isAjaxUpload?this.fileManager.count():this._inputFileCount();return this._getFileCount(e)},readFiles:function(T){this.reader=new FileReader;function I(e,t,i,a,r,n){var o=Z.extend(!0,{},F._getOutData(null,{},{},T),{id:i,index:a,fileId:r}),l=F._getFrame(i),r={id:i,index:a,fileId:r,file:t,files:T};n||F._previewDefault(t,!0),F.isAjaxUpload?setTimeout(function(){P(a+1)},F.processDelay):U=0,n||(F._initFileActions(),l.remove()),F.isError=F.isAjaxUpload?F._showFileError(e,o):F._showError(e,r),F._updateFileDetails(U)}var P,F=this,E=F.$element,S=F.reader,k=F.$previewContainer,A=F.$previewStatus,z=F.msgLoading,D=F.msgProgress,M=F.previewInitId,U=T.length,j=F.fileTypeSettings,$=F.fileManager.count(),R=F.allowedFileTypes,O=R?R.length:0,B=F.allowedFileExtensions,L=N.isEmpty(B)?"":B.join(", ");F.fileManager.clearImages(),Z.each(T,function(e,t){var i=F.fileTypeSettings.image;i&&i(t.type)&&F.fileManager.totalImages++}),(P=function(c){if((U=N.isEmpty(E.attr("multiple"))?1:U)<=c)return F.isAjaxUpload&&0<F.fileManager.count()?F._raise("filebatchselected",[F.fileManager.stack]):F._raise("filebatchselected",[T]),k.removeClass("file-thumb-loading"),void A.html("");function u(){var e=D.setTokens({index:c+1,files:U,percent:50,name:C});setTimeout(function(){A.html(e),F._updateFileDetails(U),P(c+1)},F.processDelay),F._raise("fileloaded",[v,n,c,S])}var e,p,t,i,a,r,f,g,m,h,n=M+"-"+($+c),v=T[c],w=j.text,b=j.image,_=j.html,C=F._getFileName(v,""),o=(v&&v.size||0)/1e3,l="",y=N.createObjectURL(v),s=0,d="",x=0;if(v){if(a=F.fileManager.getId(v),0<O)for(p=0;p<O;p++)i=R[p],i=F.msgFileTypes[i]||i,d+=0===p?i:", "+i;if(!1!==C){if(0===C.length)return t=F.msgInvalidFileName.replace("{name}",N.htmlEncode(N.getFileName(v),"[unknown]")),void I(t,v,n,c,a);if(N.isEmpty(B)||(l=new RegExp("\\.("+B.join("|")+")$","i")),e=o.toFixed(2),F.isAjaxUpload&&F.fileManager.exists(a)||F._getFrame(n).length)return t=F.msgDuplicateFile.setTokens({name:C,size:e}),I(t,v,n,c,a,!0),void(F.isAjaxUpload||(F._clearFileInput(),F.reset()));if(0<F.maxFileSize&&o>F.maxFileSize)return t=F.msgSizeTooLarge.setTokens({name:C,size:e,maxSize:F.maxFileSize}),void I(t,v,n,c,a);if(null!==F.minFileSize&&o<=N.getNum(F.minFileSize))return t=F.msgSizeTooSmall.setTokens({name:C,size:e,minSize:F.minFileSize}),void I(t,v,n,c,a);if(!N.isEmpty(R)&&N.isArray(R)){for(p=0;p<R.length;p+=1)r=R[p],s+=(r=j[r])&&"function"==typeof r&&r(v.type,N.getFileName(v))?1:0;if(0===s)return t=F.msgInvalidFileType.setTokens({name:C,types:d}),void I(t,v,n,c,a)}return 0!==s||N.isEmpty(B)||!N.isArray(B)||N.isEmpty(l)||(l=N.compare(C,l),0!==(s+=N.isEmpty(l)?0:l.length))?F._canPreview(v)?(f=w(v.type,C),g=_(v.type,C),m=b(v.type,C),A.html(z.replace("{index}",c+1).replace("{files}",U)),k.addClass("file-thumb-loading"),S.onerror=function(e){F._errorHandler(e,C)},S.onload=function(e){var t,i,a,r,n,o,l,s=[],d={name:C,type:v.type};if(Z.each(j,function(e,t){"object"!==e&&"other"!==e&&"function"==typeof t&&t(v.type,C)&&x++}),0===x){for(i=new Uint8Array(e.target.result),p=0;p<i.length;p++)a=i[p].toString(16),s.push(a);if(t=s.join("").toLowerCase().substring(0,8),n=N.getMimeType(t,"",""),N.isEmpty(n)&&(r=N.arrayBuffer2String(S.result),n=N.isSvg(r)?"image/svg+xml":N.getMimeType(t,r,v.type)),d={name:C,type:n},f=w(n,""),g=_(n,""),m=b(n,""),(h=f||g)||m)return o=h,(l=new FileReader).onerror=function(e){F._errorHandler(e,C)},l.onload=function(e){F._previewFile(c,v,e,y,d),F._initFileActions(),u()},void(o?l.readAsText(v,F.textEncoding):l.readAsDataURL(v))}F._previewFile(c,v,e,y,d),F._initFileActions(),u()},S.onprogress=function(e){e.lengthComputable&&(e=e.loaded/e.total*100,e=Math.ceil(e),t=D.setTokens({index:c+1,files:U,percent:e,name:C}),setTimeout(function(){A.html(t)},F.processDelay))},f||g?S.readAsText(v,F.textEncoding):m?S.readAsDataURL(v):S.readAsArrayBuffer(v),void F.fileManager.add(v)):(F.isAjaxUpload&&F.fileManager.add(v),F.showPreview&&(k.addClass("file-thumb-loading"),F._previewDefault(v),F._initFileActions()),void setTimeout(function(){F._updateFileDetails(U),P(c+1),F._raise("fileloaded",[v,n,c])},10)):(t=F.msgInvalidFileExtension.setTokens({name:C,extensions:L}),void I(t,v,n,c,a))}P(c+1)}})(0),F._updateFileDetails(U,!1)},lock:function(){var e=this,t=e.$container;return e._resetErrors(),e.disable(),t.addClass("is-locked"),e.showCancel&&t.find(".fileinput-cancel").show(),e.showPause&&t.find(".fileinput-pause").show(),e._raise("filelock",[e.fileManager.stack,e._getExtraData()]),e.$element},unlock:function(e){var t=this,i=t.$container;return void 0===e&&(e=!0),t.enable(),i.removeClass("is-locked"),t.showCancel&&i.find(".fileinput-cancel").hide(),t.showPause&&i.find(".fileinput-pause").hide(),e&&t._resetFileStack(),t._raise("fileunlock",[t.fileManager.stack,t._getExtraData()]),t.$element},resume:function(){var e=this,t=!1,i=e.$progress,a=e.resumableManager;return e.enableResumableUpload&&(e.paused?i.html(e.progressPauseTemplate.setTokens({percent:101,status:e.msgUploadResume,stats:""})):t=!0,e.paused=!1,t&&i.html(e.progressInfoTemplate.setTokens({percent:101,status:e.msgUploadBegin,stats:""})),setTimeout(function(){a.upload()},e.processDelay)),e.$element},pause:function(){var e,r=this,t=r.resumableManager,i=r.ajaxRequests,a=i.length,n=t.getProgress(),o=r.fileActionSettings;if(!r.enableResumableUpload)return r.$element;if(t.chunkIntervalId&&clearInterval(t.chunkIntervalId),r.ajaxQueueIntervalId&&clearInterval(r.ajaxQueueIntervalId),r._raise("fileuploadpaused",[r.fileManager,t]),0<a)for(e=0;e<a;e+=1)r.paused=!0,i[e].abort();return r.showPreview&&r._getThumbs().each(function(){var e=Z(this),t=e.attr("data-fileid"),i=r._getLayoutTemplate("stats"),a=e.find(".file-upload-indicator");e.removeClass("file-uploading"),a.attr("title")===o.indicatorLoadingTitle&&(r._setThumbStatus(e,"Paused"),i=i.setTokens({pendingTime:r.msgPaused,uploadSpeed:""}),r.paused=!0,r._setProgress(n,e.find(".file-thumb-progress"),n+"%",i)),r.fileManager.getFile(t)||e.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}),r._setProgress(101,r.$progress,r.msgPaused),r.$element},cancel:function(){var e,a=this,t=a.ajaxRequests,i=a.resumableManager,r=t.length;if(a.enableResumableUpload&&i.chunkIntervalId?(clearInterval(i.chunkIntervalId),i.reset(),a._raise("fileuploadcancelled",[a.fileManager,i])):a._raise("fileuploadcancelled",[a.fileManager]),a.ajaxQueueIntervalId&&clearInterval(a.ajaxQueueIntervalId),a._initAjax(),0<r)for(e=0;e<r;e+=1)a.cancelling=!0,t[e].abort();return a._getThumbs().each(function(){var e=Z(this),t=e.attr("data-fileid"),i=e.find(".file-thumb-progress");e.removeClass("file-uploading"),a._setProgress(0,i),i.hide(),a.fileManager.getFile(t)||(e.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),e.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),a.unlock()}),setTimeout(function(){a._setProgressCancelled()},a.processDelay),a.$element},clear:function(){var e,t=this;if(t._raise("fileclear"))return t.$btnUpload.removeAttr("disabled"),t._getThumbs().find("video,audio,img").each(function(){N.cleanMemory(Z(this))}),t._clearFileInput(),t._resetUpload(),t.clearFileStack(),t._resetErrors(!0),t._hasInitialPreview()?(t._showFileIcon(),t._resetPreview(),t._initPreviewActions(),t.$container.removeClass("file-input-new")):(t._getThumbs().each(function(){t._clearObjects(Z(this))}),t.isAjaxUpload&&(t.previewCache.data={}),t.$preview.html(""),e=!t.overwriteInitial&&0<t.initialCaption.length?t.initialCaption:"",t.$caption.attr("title","").val(e),N.addCss(t.$container,"file-input-new"),t._validateDefaultPreview()),0===t.$container.find(N.FRAMES).length&&(t._initCaption()||t.$captionContainer.removeClass("icon-visible")),t._hideFileIcon(),t.$captionContainer.focus(),t._setFileDropZoneTitle(),t._raise("filecleared"),t.$element},reset:function(){var e=this;if(e._raise("filereset"))return e.lastProgress=0,e._resetPreview(),e.$container.find(".fileinput-filename").text(""),N.addCss(e.$container,"file-input-new"),(e.getFrames().length||e.dropZoneEnabled)&&e.$container.removeClass("file-input-new"),e.clearFileStack(),e._setFileDropZoneTitle(),e.$element},disable:function(){var e=this;return e.isDisabled=!0,e._raise("filedisabled"),e.$element.attr("disabled","disabled"),e.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),N.addCss(e.$container.find(".btn-file"),"disabled"),e._initDragDrop(),e.$element},enable:function(){var e=this;return e.isDisabled=!1,e._raise("fileenabled"),e.$element.removeAttr("disabled"),e.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),e.$container.find(".btn-file").removeClass("disabled"),e._initDragDrop(),e.$element},upload:function(){var t,e,i=this,a=i.fileManager,r=a.count(),n=!Z.isEmptyObject(i._getExtraData());if(i.isAjaxUpload&&!i.isDisabled&&i._isFileSelectionValid(r)){if(i.lastProgress=0,i._resetUpload(),0!==r||n){if(i.cancelling=!1,i.$progress.show(),i.lock(),e=a.count(),0===r&&n)return i._setProgress(2),void i._uploadExtraOnly();if(i.enableResumableUpload)return i.resume();if(i.uploadAsync||i.enableResumableUpload){for(n=i._getOutData(null),i._raise("filebatchpreupload",[n]),i.fileBatchCompleted=!1,i.uploadCache={content:[],config:[],tags:[],append:!0},t=0;t<e;t++)i.uploadCache.content[t]=null,i.uploadCache.config[t]=null,i.uploadCache.tags[t]=null;i.$preview.find(".file-preview-initial").removeClass(N.SORT_CSS),i._initSortable(),i.cacheInitialPreview=i.getPreview()}return(i._setProgress(2),i.hasInitData=!1,i.uploadAsync)?(t=0,void Z.each(a.stack,function(e){i._uploadSingle(t,e,!0),t++})):(i._uploadBatch(),i.$element)}i._showFileError(i.msgUploadEmpty)}},destroy:function(){var e=this,t=e.$form,i=e.$container,a=e.$element,r=e.namespace;return Z(document).off(r),Z(window).off(r),t&&t.length&&t.off(r),e.isAjaxUpload&&e._clearFileInput(),e._cleanup(),e._initPreviewCache(),a.insertBefore(i).off(r).removeData(),i.off().remove(),a},refresh:function(e){var t=this,i=t.$element;return e="object"!=typeof e||N.isEmpty(e)?t.options:Z.extend(!0,{},t.options,e),t._init(e,!0),t._listen(),i},zoom:function(e){var t=this,i=t._getFrame(e),e=t.$modal;i&&(N.initModal(e),e.html(t._getModalContent()),t._setZoomContent(i),e.modal("show"),t._initZoomButtons())},getExif:function(e){e=this._getFrame(e);return e&&e.data("exif")||null},getFrames:function(e){return e=e||"",e=this.$preview.find(N.FRAMES+e),e=this.reversePreviewOrder?Z(e.get().reverse()):e},getPreview:function(){return{content:this.initialPreview,config:this.initialPreviewConfig,tags:this.initialPreviewThumbTags}}},Z.fn.fileinput=function(l){if(N.hasFileAPISupport()||N.isIE(9)){var s=Array.apply(null,arguments),d=[];switch(s.shift(),this.each(function(){var e=Z(this),t=e.data("fileinput"),i="object"==typeof l&&l,a=i.theme||e.data("theme"),r={},n={},o=i.language||e.data("language")||Z.fn.fileinput.defaults.language||"en";t||(a&&(n=Z.fn.fileinputThemes[a]||{}),"en"===o||N.isEmpty(Z.fn.fileinputLocales[o])||(r=Z.fn.fileinputLocales[o]||{}),i=Z.extend(!0,{},Z.fn.fileinput.defaults,n,Z.fn.fileinputLocales.en,r,i,e.data()),t=new c(this,i),e.data("fileinput",t)),"string"==typeof l&&d.push(t[l].apply(t,s))}),d.length){case 0:return this;case 1:return d[0];default:return d}}},Z.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showUploadStats:!0,showCancel:null,showPause:null,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:function(){var e=window.navigator.userAgent,t=!!e.match(/WebKit/i);return!(!!e.match(/iP(od|ad|hone)/i)&&t&&!e.match(/CriOS/i))},autoOrientImageInitial:!0,required:!1,rtl:!1,hideThumbnailContent:!1,encodeUrl:!0,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,sanitizeZoomCache:function(e){e=Z(document.createElement("div")).append(e);return e.find("input,select,.file-thumbnail-footer").remove(),e.html()},previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-sm btn-kv btn-default btn-outline-secondary",fullscreen:"btn btn-sm btn-kv btn-default btn-outline-secondary",borderless:"btn btn-sm btn-kv btn-default btn-outline-secondary",close:"btn btn-sm btn-kv btn-default btn-outline-secondary"},previewTemplates:{},previewContentTemplates:{},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedFileTypes:null,allowedFileExtensions:null,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedPreviewExtensions:null,disabledPreviewTypes:void 0,disabledPreviewExtensions:["msi","exe","com","zip","rar","app","vb","scr"],disabledPreviewMimeTypes:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",pauseIcon:'<i class="glyphicon glyphicon-pause"></i>',pauseClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadParamNames:{chunkCount:"chunkCount",chunkIndex:"chunkIndex",chunkSize:"chunkSize",chunkSizeStart:"chunkSizeStart",chunksUploaded:"chunksUploaded",fileBlob:"fileBlob",fileId:"fileId",fileName:"fileName",fileRelativePath:"fileRelativePath",fileSize:"fileSize",retryCount:"retryCount"},maxAjaxThreads:5,processDelay:100,queueDelay:10,progressDelay:0,enableResumableUpload:!1,resumableUploadOptions:{fallback:null,testUrl:null,chunkSize:2048,maxThreads:4,maxRetries:3,showErrorLog:!0},uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressInfoClass:"progress-bar bg-info progress-bar-info progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressPauseClass:"progress-bar bg-primary progress-bar-primary progress-bar-striped active",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:N.closeButton("kv-error-close"),slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0,reversePreviewOrder:!1,usePdfRenderer:function(){var e=!!window.MSInputMethodContext&&!!document.documentMode;return!!navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/i)||e},pdfRendererUrl:"",pdfRendererTemplate:'<iframe class="kv-preview-data file-preview-pdf" src="{renderer}?file={data}" {style}></iframe>'},Z.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear all unprocessed files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",pauseLabel:"Pause",pauseTitle:"Pause ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPaused:"Paused",msgPlaceholder:"Select {files}...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadResume:"Resuming upload...",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Upload Error",msgDeleteError:"Delete Error",msgProgressError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",msgDuplicateFile:'File "{name}" of same size "{size} KB" has already been selected earlier. Skipping duplicate selection.',msgResumableUploadRetriesExceeded:"Upload aborted beyond <b>{max}</b> retries for file <b>{file}</b>! Error Details: <pre>{error}</pre>",msgPendingTime:"{time} remaining",msgCalculatingTime:"calculating time remaining",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},Z.fn.fileinput.Constructor=c,Z(document).ready(function(){var e=Z("input.file[type=file]");e.length&&e.fileinput()})});